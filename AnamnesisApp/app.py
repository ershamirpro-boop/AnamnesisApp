from __future__ import annotations
from typing import Dict, List, Any, Tuple
from urllib.parse import quote_plus
import streamlit as st

# ========================= Page config + RTL =========================
st.set_page_config(page_title="Smart Anamnesis â€¢ ×ª×œ×•× ×•×ª", page_icon="ğŸ©º", layout="wide")
st.markdown("""
<style>
.stApp{direction:rtl}
.block-container{padding-top:12px;padding-bottom:20px}
h1,h2,h3,h4{letter-spacing:.2px;text-align:right}
p,li,span,label,.stMarkdown{text-align:right}
.card{background:rgba(255,255,255,.84);border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:14px 16px}
@media (prefers-color-scheme:dark){.card{background:rgba(17,24,39,.85);border:1px solid rgba(255,255,255,.12)}}
.hr{height:1px;background:linear-gradient(90deg,transparent,rgba(128,128,128,.35),transparent);margin:12px 0 18px}
[data-testid='stSidebar']{display:none}
</style>
""", unsafe_allow_html=True)
from datetime import datetime
try:
    from streamlit_autorefresh import st_autorefresh
    st_autorefresh(interval=5 * 60 * 1000, limit=None, key="keepalive_5m")
    st.caption(f"â± ×¨×¢× ×•×Ÿ ××—×¨×•×Ÿ: {datetime.now().strftime('%H:%M:%S')}")
except Exception:
    # ×× ×”×—×‘×™×œ×” ×œ× ××•×ª×§× ×ª â€“ ×œ× × ×§×¨×•×¡
    pass

# ========================= ×¢×–×¨×™ ×™×¦×™×¨×” ××§×•×¦×¨×™× =========================
def L(test: str, why: str = "", when: str = "") -> Dict[str, str]:
    o = {"test": test}
    if why:  o["why"] = why
    if when: o["when"] = when
    return o

def IMG(modality: str, trigger: str = "") -> Dict[str, str]:
    o = {"modality": modality}
    if trigger: o["trigger"] = trigger
    return o

def S(name: str, about: str = "", rule_in: str = "", rule_out: str = "", ref: str = "") -> Dict[str, str]:
    o = {"name": name}
    if about:    o["about"] = about
    if rule_in:  o["rule_in"] = rule_in
    if rule_out: o["rule_out"] = rule_out
    if ref:      o["ref"] = ref
    return o

# ========================= ×§×™×©×•×¨×™ ×•×™×“××• ×‘×¨×™×¨×ªÖ¾××—×“×œ ×œ×¤×™ label =========================
DEFAULT_VIDEO_MAP: Dict[str, List[str]] = {
    # ×œ×‘/× ×©×™××”
    "×”××–× ×” ×œ×œ×‘ (×§×¦×‘/××•×•×©×•×ª)": ["https://www.youtube.com/results?search_query="+quote_plus("cardiac auscultation osce")],
    "JVP ×•×‘×¦×§×•×ª ×”×™×§×¤×™×•×ª": ["https://www.youtube.com/watch?v=Ez7KsKRi8e8"],
    "×”××–× ×” ×œ×¨×™××•×ª (×§×¨××§×œ×¡)": ["https://www.youtube.com/results?search_query="+quote_plus("lung auscultation osce")],
    "×”××–× ×” - ×¦×¤×¦×•×¤×™×/×§×¨××§×œ×¡": ["https://www.youtube.com/results?search_query="+quote_plus("lung auscultation osce")],
    "×¡×˜×•×¨×¦×™×” ×•-RR": ["https://www.youtube.com/results?search_query="+quote_plus("pulse oximetry respiratory rate")],
    "POCUS ×œ×‘/×¨×™××•×ª": ["https://www.youtube.com/results?search_query="+quote_plus("lung ultrasound B lines pleural effusion")],
    "××™×©×•×© ×“×•×¤×Ÿ ×—×–×”": ["https://www.youtube.com/results?search_query="+quote_plus("chest wall palpation examination")],
    # × ×•×™×¨×•
    "×‘×“×™×§×” × ×•×™×¨×•×œ×•×’×™×ª ×××•×§×“×ª": ["https://www.youtube.com/results?search_query="+quote_plus("neurological examination osce")],
    "×‘×“×™×§×” × ×•×™×¨×•×œ×•×’×™×ª ×××•×§×“×ª/×¢×¦×‘×™ ×’×•×œ×’×•×œ×ª": ["https://www.youtube.com/results?search_query="+quote_plus("cranial nerve examination osce")],
    "×¢×¦×‘×™ ×’×•×œ×’×•×œ×ª": ["https://www.youtube.com/results?search_query="+quote_plus("cranial nerve examination osce")],
    "Dix-Hallpike": ["https://www.youtube.com/watch?v=D6qEdlFVxig","https://www.youtube.com/watch?v=Ey7TlLJUErY"],
    "×‘×“×™×§×ª × ×™×¡×˜×’××•×¡": ["https://www.youtube.com/results?search_query="+quote_plus("nystagmus examination osce")],
    # ×‘×˜×Ÿ
    "××™×©×•×© ×‘×˜×Ÿ ×•×”×¢×¨×›×ª ×¨×’×™×©×•×ª": ["https://www.youtube.com/results?search_query="+quote_plus("abdominal examination palpation osce")],
    "×¡×™×× ×™ ×’×™×¨×•×™ ×¦×¤×§×™ ×•×¨×™×‘××•× ×“": ["https://www.youtube.com/results?search_query="+quote_plus("peritoneal signs rebound guarding exam")],
    "×¡×™××Ÿ ××¨×¤×™": ["https://www.youtube.com/results?search_query="+quote_plus("Murphy sign examination")],
    "US ×‘×˜×Ÿ": ["https://www.youtube.com/results?search_query="+quote_plus("abdominal ultrasound basics")],
    # ×’× ×™×˜×•××•×¨×™× ×¨×™
    "×¨×’×™×©×•×ª CVA": ["https://www.youtube.com/results?search_query="+quote_plus("CVA tenderness exam")],
    "×‘×“×™×§×ª ××–×•×¨ ×”×©×•×¤×›×” ×•×”×¤× ×™×¡/×¤×¨×™× ××•×": ["https://www.youtube.com/results?search_query="+quote_plus("male genitourinary exam osce")],
    # ×.×.×’
    "×˜××¤×•× ×“×” ×§×“××™×ª ×× ×¦×¨×™×š": ["https://www.youtube.com/results?search_query="+quote_plus("anterior nasal packing epistaxis")],
    "×‘×“×™×§×” ×§×“××™×ª ×©×œ ××£/××•×–×Ÿ/×œ×•×¢": ["https://www.youtube.com/results?search_query="+quote_plus("ENT anterior rhinoscopy otoscopy oropharynx exam")],
    # ×¢×•×¨
    "×”×¢×¨×›×ª ×¢×•×¨ - ××•×¨×¤×•×œ×•×’×™×” ×•×”×ª×¤×©×˜×•×ª": ["https://www.youtube.com/results?search_query="+quote_plus("skin examination osce")],
    "×‘×“×™×§×ª ×–×™×”×•× ×¨×§××•×ª ×¨×›×•×ª (×¦×œ×•×œ×™×˜×™×¡/××‘×¦×¡)": ["https://www.youtube.com/results?search_query="+quote_plus("soft tissue infection abscess exam")],
    "×‘×“×™×§×” ×œ-DVT ×‘×¨×’×œ×™×™×": ["https://www.youtube.com/results?search_query="+quote_plus("POCUS DVT compression ultrasound")],
    # ×¢×™× ×™×™×
    "×‘×“×™×§×ª ×—×“×•×ª ×¨××™×™×”": ["https://www.youtube.com/results?search_query="+quote_plus("visual acuity snellen osce")],
    "×©×“×•×ª ×¨××™×™×” ×•×ª× ×•×¢×•×ª ×¢×™× ×™×™×": ["https://www.youtube.com/results?search_query="+quote_plus("eye movements visual fields examination")],
    "×¤×œ×•××•×¨×¡×¦××™×Ÿ/×”×¤×™×›×ª ×¢×¤×¢×£": ["https://www.youtube.com/results?search_query="+quote_plus("eyelid eversion fluorescein")],
    # ×¢×–×¨ ×›×œ×œ×™
    "×¦×™×œ×•× ×—×–×”": ["https://www.youtube.com/results?search_query="+quote_plus("chest xray interpretation basics")],
}

def attach_video_links(block: Dict[str, Any]) -> None:
    for it in block.get("physical_exam", []):
        if isinstance(it, dict):
            label = (it.get("label") or "").strip()
            if label and not it.get("url"):
                url = (DEFAULT_VIDEO_MAP.get(label, []) or
                       ["https://www.youtube.com/results?search_query=" + quote_plus(label)])[0]
                it["url"] = url

# ========================= ×ª×•×›×Ÿ ×”×ª×œ×•× ×•×ª (×œ×œ× ×—×œ×•×§×” ×œ××¢×¨×›×•×ª) =========================
# ×”×¢×¨×”: ×–×”×• seed ×¨×—×‘ ×•××•×›×Ÿ ×œ×¢×‘×•×“×”. × ×™×ª×Ÿ ×œ×”×¨×—×™×‘/×œ×©× ×•×ª ×›×œ ×ª×œ×•× ×” ×‘×§×œ×•×ª.
COMPLAINTS: Dict[str, Dict[str, Any]] = {
    # --- ×œ×‘ ×•×›×œ×™ ×“× ---
    "×›××‘ ×‘×—×–×”": {
        "questions": ["××—×œ×ª ×—×•× ××• ×©×™×¢×•×œ","×¨×§×¢ ××©×¤×—×ª×™","××ª×™ ×”×ª×—×™×œ", "××•×¤×™ ×›××‘ ×•×”×§×¨× ×”", "×˜×¨×™×’×¨ - ××××¥/×× ×•×—×”/×œ××—×¨ ××•×›×œ", "×”×–×¢×”/×‘×—×™×œ×”/×§×•×¦×¨ × ×©×™××”"],
        "physical_exam": [{"label":"×”××–× ×” ×œ×œ×‘ (×§×¦×‘/××•×•×©×•×ª)"},{"label":"×”××–× ×” ×œ×¨×™××•×ª (×§×¨××§×œ×¡)"},{"label":"JVP ×•×‘×¦×§×•×ª ×”×™×§×¤×™×•×ª"},{"label":"××™×©×•×© ×“×•×¤×Ÿ ×—×–×”"}],
        "labs": [L("×˜×¨×•×¤×•× ×™×Ÿ ×¡×“×¨×ª×™","××‘×—× ×ª ACS","××™×“×™"), L("BMP, ×’×œ×•×§×•×–","××œ×§×˜×¨×•×œ×™×˜×™×/×›×œ×™×”"), L("CBC, ×§×¨×™×©×”","×× ××™×”/×œ×¤× ×™ ×”×ª×¢×¨×‘×•×ª")],
        "imaging": [IMG("ECG ××™×™×“×™","×œ×›×œ ×›××‘ ×—×–×” ×—×¨×™×’"), IMG("×¦×™×œ×•× ×—×–×”","×—×©×“ ×¨×™××ª×™/×œ×‘×‘×™")],
        "scores": [S("HEART","×¡×™×›×•×Ÿ ×œ-ACS","â‰¥7 ×’×‘×•×”","0-3 × ××•×š"), S("Wells/PERC ×œ-PE","×”×¡×ª×‘×¨×•×ª ×œ-PE","CTA ×× ×‘×™× ×•× ×™/×’×‘×•×”","PERC ×œ×©×œ×™×œ×” ×‘×¡×™×›×•×Ÿ × ××•×š")],
        "notes": []
    },
    "×“×¤×™×§×•×ª ×œ×‘": {
        "questions": [" ×¤×ª××•××™/×”×“×¨×’×ª×™, ××©×š", "×§×¦×‘ ×¡×“×™×¨/×œ× ×¡×“×™×¨", "×˜×¨×™×’×¨×™× - ×§×¤×”/××œ×›×•×”×•×œ/××××¥/×œ×—×¥", "×¡×™× ×§×•×¤×”/×§×•×¦×¨ × ×©×™××”/×›××‘ ×‘×—×–×”"],
        "physical_exam": [{"label":"××“×“×™× ×•×¡×˜×•×¨×¦×™×”"},{"label":"×”××–× ×” ×œ×œ×‘ (×§×¦×‘/××•×•×©×•×ª)"}],
        "labs": [L("TSH, T4","×ª×™×¨×•×˜×•×§×¡×™×§×•×–×™×¡"), L("××œ×§×˜×¨×•×œ×™×˜×™× ×›×•×œ×œ Mg","×¢×•×¨×¨×•×ª ×§×¦×‘"), L("CBC","×× ××™×”")],
        "imaging": [IMG("ECG 12 ×œ×™×“×™×","×‘×¢×ª ×ª×œ×•× ×”"), IMG("Holter 24-48h","×ª×œ×•× ×•×ª ×”×ª×§×¤×™×•×ª")],
        "scores": [S("CHADS2-VASc","×¡×™×›×•×Ÿ ×ª×¨×•××‘×•×××‘×•×œ×™ ×‘×¤×¨×¤×•×¨","×’×‘×•×” - ×× ×˜×™×§×•××’×•×œ×¦×™×”","0 ×‘×’×‘×¨ ×œ×¨×•×‘ ×œ×œ×"), S("EHRA","×—×•××¨×ª ×ª×¡××™× ×™×")],
        "notes": []
    },
    "×‘×¦×§×•×ª ×‘×¨×’×œ×™×™×": {
        "questions": ["×¤×ª××•××™/×”×“×¨×’×ª×™, ×—×“/×“×• ×¦×“×“×™", "×§×•×¦×¨ × ×©×™××”/×¢×œ×™×™×” ×‘××©×§×œ/×“×™×•×¨×–×™×¡ ×™×¨×•×“", "×ª×¨×•×¤×•×ª: CCB/NSAIDs/×¡×˜×¨×•××™×“×™×", "××™ ×¡×¤×™×§×ª ×œ×‘/×›×œ×™×•×ª/×›×‘×“", "×›××‘/×—×•× ××§×•××™/×©×™× ×•×™ ×¦×‘×¢ (DVT)"],
        "physical_exam": [{"label":"JVP ×•×‘×¦×§×•×ª ×”×™×§×¤×™×•×ª"},{"label":"×”××–× ×” ×œ×œ×‘ (×§×¦×‘/××•×•×©×•×ª)"},{"label":"×”××–× ×” ×œ×¨×™××•×ª (×§×¨××§×œ×¡)"}],
        "labs": [L("BNP/NT-proBNP","××™ ×¡×¤×™×§×ª ×œ×‘","×‘×›×œ ×—×©×“"), L("BMP","×›×œ×™×”/××œ×§×˜×¨×•×œ×™×˜×™×","××§×¨×” ×—×“×©"), L("×ª×¤×§×•×“×™ ×›×‘×“ + ××œ×‘×•××™×Ÿ","×¦×™×¨×•×–×™×¡/××™×™××ª"), L("CBC","×× ××™×”/×–×™×”×•×")],
        "imaging": [IMG("ECG","×§×¦×‘/×¢×•××¡"), IMG("Echo ×œ×‘","EF ×•×œ×—×¥ ×¨×™××ª×™"), IMG("US ×•×¨×™×“×™× ×ª×—×ª×•× ×™×","×‘×¦×§×ª ×—×“ ×¦×“×“×™×ª")],
        "scores": [S("Framingham HF","×§×¨×™×˜×¨×™×•× ×™× ×œ-HF","â‰¥2 ×’×“×•×œ×™×"), S("NYHA","×“×¨×’×ª ×ª×¤×§×•×“"), S("Wells DVT","×¡×™×›×•×Ÿ ×œ-DVT","â‰¥2 - US","<2 + D-dimer ×©×œ×™×œ×™")],
        "notes": []
    },
    "×¡×™× ×§×•×¤×”": {
        "questions": ["× ×¡×™×‘×•×ª ×”××™×¨×•×¢, ×˜×¨×™×’×¨×™×, ×¤×¨×•×“×¨×•×", "××©×š ××•×‘×“×Ÿ ×”×›×¨×” ×•×”×ª××•×©×©×•×ª", "×¨×§×¢ ×œ×‘×‘×™/×§×•×¦×‘/×ª×¨×•×¤×•×ª"],
        "physical_exam": [{"label":"××•×¨×ª×•×¡×˜×˜×–×™×-××“×“×™× ×›×•×œ×œ ×œ×—×¥ ×“× ×‘×¢××™×“×”"},{"label":"×”××–× ×” ×œ×œ×‘ (×§×¦×‘/××•×•×©×•×ª)"}],
        "labs": [L("ECG","Arrhythmia/×‘×œ×•×§"), L("×’×œ×•×§×•×–","×”×™×¤×•×’×œ×™×§××™×”"), L("Hb","×× ××™×” ×§×©×”")],
        "imaging": [IMG("Echo","×× ×—×©×“ ××‘× ×™"), IMG("××•× ×™×˜×•×¨/×”×•×œ×˜×¨","××™×¨×•×¢×™× ×—×•×–×¨×™×")],
        "scores": [S("San Francisco Syncope","×¡×™×›×•×Ÿ ×œ××™×¨×•×¢ ×—××•×¨","× ×•×›×—×•×ª ×§×¨×™×˜×¨×™×•×Ÿ ××¢×œ×” ×¡×™×›×•×Ÿ")],
        "notes": []
    },
    "×™×ª×¨ ×œ×—×¥ ×“×": {
        "questions": ["××“×™×“×•×ª ×§×•×“××•×ª ×•××©×›×Ÿ", "×ª×¡××™× ×™ ××™×‘×¨ ××˜×¨×”: ×›××‘ ×—×–×”/×§×•×¦×¨ × ×©×™××”/× ×•×™×¨×•×œ×•×’×™/×¤×’×™×¢×” ×‘×¨××™×™×”/××•×œ×™×’×•×¨×™×”?", "×ª×¨×•×¤×•×ª/×”×—××¦×•×ª/NSAIDs/×§×•×§××™×Ÿ/×¡×˜×™××•×œ× ×˜×™×?"],
        "physical_exam": [{"label":"××“×“×™× ×›×•×œ×œ ×œ\"×“ ×‘×©×ª×™ ×™×“×™×™×"},{"label":"×”××–× ×” ×œ×œ×‘ (×§×¦×‘/××•×•×©×•×ª)"},{"label":"×”××–× ×” ×œ×¨×™××•×ª (×§×¨××§×œ×¡)"}],
        "labs": [L("BMP (Naâº, Kâº, Cr)","×›×œ×™×”/××œ×§×˜×¨×•×œ×™×˜×™×"), L("UA","×—×œ×‘×•×Ÿ/×“× â€“ ×¤×’×™×¢×” ×›×œ×™×™×ª×™×ª"), L("×˜×¨×•×¤×•× ×™×Ÿ","×œ×‘","×× ×›××‘ ×—×–×”/×ª×¡××™× ×™ ×œ×‘")],
        "imaging": [IMG("ECG","×©×™× ×•×™×™×/×¢×•××¡"), IMG("×¦×™×œ×•× ×—×–×”","×‘×—×©×“ ×œ×‘×¦×§×ª ×¨×™××•×ª/×§×¨×“×™×•××’×œ×™×”")],
        "scores": [],
        "notes": [
            "×¡×™×•×•×’: **Hypertensive Urgency** â€“ ×œ\"×“ ×’×‘×•×” ×œ×œ× ×¤×’×™×¢×” ×‘××™×‘×¨ ××˜×¨×”.",
            "×¡×™×•×•×’: **Hypertensive Emergency** â€“ ×œ\"×“ ×’×‘×•×” ×¢× ×¤×’×™×¢×” ×‘××™×‘×¨ ××˜×¨×” (×œ×‘/××•×—/×›×œ×™×”/×¢×™× ×™×™×/×¨×™××•×ª).",
            "×¡×™×•×•×’: **Hypertensive Crisis** â€“ ××˜×¨×™×” ×›×œ×œ×™×ª; ×™×© ×œ××ª×¨ Target-organ damage."
        ]
    },

    # --- × ×©×™××” ---
    "×§×•×¦×¨ × ×©×™××”": {
        "questions": ["×¤×ª××•××™/×”×“×¨×’×ª×™? ×× ×•×—×”/××××¥?", "×—×•×/×›××‘ ×¤×œ××•×¨×™×˜×™/×”××•×¤×˜×™×–×™×¡/×¦×¤×¦×•×¤×™×", "PE risks: × ×™×ª×•×—/Immobilization/×¡×¨×˜×Ÿ/×”×¨×™×•×Ÿ"],
        "physical_exam": [{"label":"×¡×˜×•×¨×¦×™×” ×•-RR"},{"label":"×”××–× ×” - ×¦×¤×¦×•×¤×™×/×§×¨××§×œ×¡"},{"label":"JVP ×•×‘×¦×§×•×ª ×”×™×§×¤×™×•×ª"}],
        "labs": [L("ABG/VBG","××•×•×¨×•×¨/×—××¦×•×Ÿ","××¦×•×§×”"), L("CBC, CRP","×–×™×”×•×/×“×œ×§×ª"), L("BMP","××œ×§×˜×¨×•×œ×™×˜×™×"), L("BNP/NT-proBNP","HF"), L("D-dimer","PE","×¡×™×›×•×Ÿ × ××•×š/×‘×™× ×•× ×™")],
        "imaging": [IMG("×¦×™×œ×•× ×—×–×”","×§×• ×¨××©×•×Ÿ"), IMG("CT ×× ×’×™×• ×—×–×”","Wells ×‘×™× ×•× ×™/×’×‘×•×” ××• D-dimer ×—×™×•×‘×™"), IMG("POCUS ×œ×‘/×¨×™××•×ª","×¡×™×•×¢ ×œ×“×™×¤×¨× ×¦×™××œ")],
        "scores": [S("Wells - PE","×”×¡×ª×‘×¨×•×ª ×œ-PE","CTA ×× ×‘×™× ×•× ×™/×’×‘×•×”","PERC ×œ×©×œ×™×œ×” ×‘×¡×™×›×•×Ÿ × ××•×š"), S("PERC","×©×œ×™×œ×ª PE ×‘×¡×™×›×•×Ÿ × ××•×š","", "×›×œ ×”×§×¨×™×˜×¨×™×•× ×™× ×©×œ×™×œ×™×™×")],
        "notes": []
    },
    "×©×™×¢×•×œ": {
        "questions": ["×™×‘×©/×œ×™×—×ª×™, ××©×š, ×—×•×, ×”××•×¤×˜×™×–×™×¡?", "×—×©×™×¤×” ×œ×¢×™×©×•×Ÿ/×¡×‘×™×‘×”?"],
        "physical_exam": [{"label":"×”××–× ×” ×œ×¨×™××•×ª (×§×¨××§×œ×¡)"}],
        "labs": [L("CRP, CBC","×–×™×”×•×","×œ×¤×™ ×§×œ×™× ×™×§×”")],
        "imaging": [IMG("×¦×™×œ×•× ×—×–×”","×××•×©×š ××• ×—××•×¨")],
        "scores": []
    },
    "×”××•×¤×˜×™×–×™×¡": {
        "questions": ["×›××•×ª/×§×¨×™×©×™×/××©×š", "Dyspnea/×›××‘ ×¤×œ××•×¨×™×˜×™", "TB/××××™×¨×•×ª/×§×¨×™×©×™×•×ª?"],
        "physical_exam": [{"label":"×¡×˜×•×¨×¦×™×” ×•-RR"},{"label":"×”××–× ×” ×œ×¨×™××•×ª (×§×¨××§×œ×¡)"},{"label":"×‘×“×™×§×” ×œ-DVT ×‘×¨×’×œ×™×™×"}],
        "labs": [L("CBC","Hb/×œ×•×™×§×•×¦×™×˜×™×"), L("×§×¨×™×©×”","INR/aPTT"), L("×¡×•×’ ×•×”×¦×œ×‘×”","Massive"), L("D-dimer","PE","×¡×™×›×•×Ÿ × ××•×š/×‘×™× ×•× ×™")],
        "imaging": [IMG("×¦×™×œ×•× ×—×–×”","×§×• ×¨××©×•×Ÿ"), IMG("CTA ×—×–×”","×—×©×“ ×œ-PE/×“×™××•× ×¤×¢×™×œ")],
        "scores": []
    },
    "××¡×ª××” â€“ ×”×—××¨×”": {
        "questions": ["×˜×¨×™×’×¨/××œ×¨×’× ×™×/×—×©×™×¤×”", "×©×™××•×© ×‘××©××¤×™× ×œ××—×¨×•× ×” ×•×›××•×ª ××©××¤×™×", "××©×¤×•×–×™×/××™× ×˜×•×‘×¦×™×” ×‘×¢×‘×¨"],
        "physical_exam": [{"label":"×¡×˜×•×¨×¦×™×” ×•-RR"},{"label":"×”××–× ×” - ×¦×¤×¦×•×¤×™×/×§×¨××§×œ×¡"}],
        "labs": [L("ABG/VBG","×’×–×™× ××”×™×¨×™×","×—××¦×•×Ÿ/××•×•×¨×•×¨","××¦×•×§×” × ×©×™××ª×™×ª")],
        "imaging": [IMG("×¦×™×œ×•× ×—×–×”","×× ×™×© ×—×©×“ ×œ××˜×œ×§×˜×–×™×¡/×¤× ××•××•× ×™×” ")],
        "scores": []
    },
    "COPD â€“ ×”×—××¨×”": {
        "questions": ["×›××‘×™× ×‘×—×–×”","×¦×‘×¢ ×•××•×¤×™ ×›×™×—/××—×œ×ª ×—×•×", "×©×™××•×© ×‘×—××¦×Ÿ ×‘×™×ª×™/BiPAP", "××©×¤×•×–×™× ×§×•×“××™×"],
        "physical_exam": [{"label":"×¡×˜×•×¨×¦×™×” ×•-RR"},{"label":"×”××–× ×” - ×¦×¤×¦×•×¤×™×/×§×¨××§×œ×¡"}],
        "labs": [L("ABG/VBG","Hypercapnia/Acidosis","××¦×•×§×” × ×©×™××ª×™×ª","×˜×¨×•×¤×•× ×™×Ÿ","×’×–×™× ××”×™×¨×™×")],
        "imaging": [IMG("×¦×™×œ×•× ×—×–×”","×œ×—×™×¤×•×© ×¡×™×‘×•×š/×–×™×”×•×")],
        "scores": []
    },
    "×—×©×“ ×œ×“×œ×§×ª ×¨×™××•×ª ": {
        "questions": ["×—×•×/×¦××¨××•×¨×ª","×—×•×/×¦××¨××•×¨×•×ª/×›×™×—", "×›××‘ ×¤×œ××•×¨×™×˜×™/×§×•×¦×¨ × ×©×™××”", "×’×•×¨××™ ×¡×™×›×•×Ÿ/ Aspiration"],
        "physical_exam": [{"label":"×”××–× ×” ×œ×¨×™××•×ª (×§×¨××§×œ×¡)"}],
        "labs": [L("CBC, CRP","×–×™×”×•×/×“×œ×§×ª")],
        "imaging": [IMG("×¦×™×œ×•× ×—×–×”","×§×• ×¨××©×•×Ÿ")],
        "scores": []
    },

    # --- × ×•×™×¨×•×œ×•×’×™×” ---
    "×—×•×œ×©×ª ×¦×“ / ×—×©×“ ×œ×©×‘×¥": {
        "questions": ["×–××Ÿ ××—×¨×•×Ÿ ×ª×§×™×Ÿ (LKW)", "×ª×¡××™× ×™ NIHSS - ×“×™×‘×•×¨/×¨××™×™×”/×’×¤×”/×¤× ×™×", "×× ×˜×™×§×•××’×•×œ×¦×™×”/×“×™××•×/×˜×¨××•××”?"],
        "physical_exam": [{"label":"×‘×“×™×§×” × ×•×™×¨×•×œ×•×’×™×ª ×××•×§×“×ª"},{"label":"×œ×—×¥ ×“×"}],
        "labs": [L("CBC, ×§×¨×™×©×”, BMP","×œ×¤× ×™ ×˜×™×¤×•×œ ×ª×¨×•×¤×ª×™/×¤×¨×•×¦×“×•×¨×•×ª")],
        "imaging": [IMG("CT ×¨××© ×œ×œ× × ×™×’×•×“","×“×™××•×"), IMG("CTA ×¨××©-×¦×•×•××¨","×—×©×“ ×œ-LVO")],
        "scores": [S("NIHSS","×—×•××¨×ª ×—×¡×¨","×’×‘×•×” - ×”×¡×œ××”")],
        "notes": []
    },
    "TIA - ×ª×¡××™× ×™× ×©×—×œ×¤×•": {
        "questions": ["××©×š ××™×¨×•×¢, ×ª×“×™×¨×•×ª", "×™×œ\"×“/AF/DM/×¢×™×©×•×Ÿ", "Amaurosis fugax"],
        "physical_exam": [{"label":"×‘×“×™×§×” × ×•×™×¨×•×œ×•×’×™×ª ×××•×§×“×ª"}],
        "labs": [L("×’×œ×•×§×•×–, ×œ×™×¤×™×“×™×, HbA1c","×¡×™×›×•×Ÿ ×§×¨×“×™×•×•×¡×§×•×œ×¨×™")],
        "imaging": [IMG("CTA/US ×§×¨×•×˜×™×“×™×","××§×•×¨ ×××‘×•×œ×™"), IMG("MRI ×“×™×¤×•×–×™×”","××•×˜××™× ×¢×“×™× ×™×")],
        "scores": [S("ABCD2","×¡×™×›×•×Ÿ ×œ×©×‘×¥ ××•×§×“×","â‰¥4 ×‘×™× ×•× ×™-×’×‘×•×”")],
        "notes": []
    },
    "×¡×—×¨×—×•×¨×ª": {
        "questions": ["×©×™××•×© ×‘××“×œ×œ×™ ×“× ××• ×œ×—×¦×™ ×“× ×œ× ×××•×–× ×™×","×ª× ×•×—×ª×™/××™ ×™×¦×™×‘×•×ª? ×”×ª×§×¤×™/××ª××©×š?", "×©××™×¢×”/×˜×™× ×˜×•×Ÿ/× ×•×™×¨×• × ×•×¡×¤×™×?"],
        "physical_exam": [{"label":"Dix-Hallpike"},{"label":"×‘×“×™×§×ª × ×™×¡×˜×’××•×¡"}],
        "labs": [],
        "imaging": [IMG("CTA/CTV ××•×—","×—×©×“ ××¨×›×–×™/×¡×™×× ×™× ×¤×•×§×œ×™×™×")],
        "scores": [S("HINTS (×œ××™×•×× ×™×)","×¤×¨×™×¤×¨×™ ××•×œ ××¨×›×–×™","Head-Impulse ×ª×§×™×Ÿ/Skew","×œ× ×œ××ª×—×™×œ×™×")]
    },
    "×›××‘ ×¨××©": {
        "questions": ["×¦×“/××¢×™×¨ ××©×™× ×” /××’×™×‘ ×œ×× ×œ×’×˜×™×§×”/ ××©×ª× ×” ×‘××’×¢","thunderclap? ×”×—××¨×” ×—×“×©×”?", "×¤×•×˜×•×¤×•×‘×™×”/×‘×—×™×œ×”/×—×¡×š × ×•×™×¨×•×œ×•×’×™ ×¤×•×§×œ×™", "×“×œ×§×ª ×›×œ×™ ×“×/×”×¨×™×•×Ÿ/××“×œ×œ×™×?"],
        "physical_exam": [{"label":"×‘×“×™×§×” × ×•×™×¨×•×œ×•×’×™×ª ×××•×§×“×ª"},{"label":"×¢×•×¨×£ - × ×•×§×©×•×ª"}],
        "labs": [L("CRP/ESR","Temporal arteritis >50y"), L("Î²-hCG","× ×©×™× ×‘×’×™×œ ×”×¤×•×¨×™×•×ª")],
        "imaging": [IMG("CT ×¨××©","red flags"), IMG("CTA/CTV","×—×©×“ ×œ-SAH/×ª×¨×•××‘×•×–×™×¡ ×•×¨×™×“×™")]
    },
    "×¤×¨×›×•×¡": {
        "questions": ["×¢×“×™×/××©×š/×¤×•×¡×˜-××™×§×˜×œ×™", "×ª×¨×•×¤×•×ª/×”×¤×¡×§×ª ×× ×˜×™××¤×™×œ×¤×˜×™×™×", "××œ×›×•×”×•×œ/×¡××™×/×—×•×"],
        "physical_exam": [{"label":"×‘×“×™×§×” × ×•×™×¨×•×œ×•×’×™×ª ×××•×§×“×ª"}],
        "labs": [L("×’×–×™× ××”×™×¨×™× ×•×œ×§×˜×˜","CK","×’×œ×•×§×•×–","×”×™×¤×•×’×œ×™×§××™×”"), L("×©×ª×Ÿ ×œ×˜×•×§×¡×™×§×•×œ×•×’×™×”","××œ×§×˜×¨×•×œ×™×˜×™×","×“×™×¡××œ×§×˜×¨×•×œ××™×”")],
        "imaging": [IMG("CT ×¨××©","×¤×’×™×¢×”/×“×™××•×/×’×™×“×•×œ")],
        "scores": []
    },

    # --- ×’×¡×˜×¨×• ---
    "×‘×—×™×œ×•×ª/×”×§××•×ª": {
        "questions": ["××©×š, ×™×›×•×œ×ª ×©×ª×™×”/××›×™×œ×”", "×“× ×‘×§×™×/××¨×”/×¢×¦×™×¨×•×ª", "×ª×¨×•×¤×•×ª/×”×¨×™×•×Ÿ"],
        "physical_exam": [{"label":"×¡×™×× ×™ ×”×ª×™×™×‘×©×•×ª"},{"label":"××™×©×•×© ×‘×˜×Ÿ ×•×”×¢×¨×›×ª ×¨×’×™×©×•×ª"}],
        "labs": [L("BMP","××œ×§×˜×¨×•×œ×™×˜×™×/×›×œ×™×”"), L("×’×œ×•×§×•×–","DKA?"), L("Î²-hCG","× ×©×™× ×‘×’×™×œ ×”×¤×•×¨×™×•×ª")],
        "imaging": [IMG("US/CT","×œ×¤×™ ×§×œ×™× ×™×§×”")]
    },
    "×›××‘ ×‘×¨×‘×™×¢ ×™×× ×™ ×¢×œ×™×•×Ÿ": {
        "questions": ["×§×•×œ×™×§×™/×œ× ×§×•×œ×™×§×™, ×œ××—×¨ ××•×›×œ ×©××Ÿ", "×—×•×/×¦×”×‘×ª/×”×§××•×ª"],
        "physical_exam": [{"label":"×¡×™××Ÿ ××¨×¤×™"},{"label":"××™×©×•×© ×‘×˜×Ÿ ×•×”×¢×¨×›×ª ×¨×’×™×©×•×ª"}],
        "labs": [L("×× ×–×™××™ ×›×‘×“","×›×•×œ×¡×˜×˜×™/×”×¤×˜×•×¦×œ×•×œ×¨×™"), L("×œ×™×¤××–","×“×™×¤×¨× ×¦×™××œ ×œ×‘×œ×‘"), L("CBC, CRP","×“×œ×§×ª")],
        "imaging": [IMG("US ×›×™×¡ ××¨×”/×“×¨×›×™ ××¨×”","×§×• ×¨××©×•×Ÿ"), IMG("MRCP/ERCP","×—×©×“ ×œ××‘×Ÿ ×‘-CBD")]
    },
    "RLQ - ×—×©×“ ×œ××¤× ×“×™×¦×™×˜×™×¡": {
        "questions": ["××¢×‘×¨ ×›××‘ ×××™×¤×™×’×¡×˜×¨×™×•× ×œ-RLQ", "×—×•×/×—×•×œ×©×”/×‘×—×™×œ×”"],
        "physical_exam": [{"label":"×¨×’×™×©×•×ª ××§×‘×¨× ×™"},{"label":"×¡×™×× ×™ ×’×™×¨×•×™ ×¦×¤×§×™ ×•×¨×™×‘××•× ×“"}],
        "labs": [L("CBC","×œ×•×™×§×•×¦×™×˜×•×–×™×¡"), L("CRP","×“×œ×§×ª")],
        "imaging": [IMG("US/CT","×œ×¤×™ BMI ×•×’×™×œ")],
        "scores": [S("Alvarado","××¤× ×“×™×¦×™×˜×™×¡","â‰¥7 ×ª×•××š","<5 ××¤×—×™×ª")]
    },
    "×“×™××•× ×¨×§×˜×œ×™": {
        "questions": ["×›××•×ª/×¦×‘×¢/×›××‘/×¢×¦×™×¨×•×ª", "××“×œ×œ×™×/IBD/×©×œ×©×•×œ×™×/×¤××™×—×”"],
        "physical_exam": [{"label":" PR-×‘×“×™×§×ª"},{"label":"×¡×™×× ×™ ×”×™×¤×•×•×œ××™×”"}],
        "labs": [L("CBC","Hb"), L("×§×¨×™×©×”","INR/aPTT"), L("×¡×•×’ ×•×”×¦×œ×‘×”","×“×™××•× ××©××¢×•×ª×™")],
        "imaging": [IMG("×§×•×œ×•× ×•×¡×§×•×¤×™×”/CT ×× ×’×™×•","×œ×¤×™ ×™×¦×™×‘×•×ª")]
    },
    "×›××‘ ××¤×™×’×¡×˜×¨×™/×“×™×¡×¤×¤×¡×™×”": {
        "questions": ["×§×©×¨ ×œ××•×›×œ/NSAIDs", "×™×¨×™×“×” ×‘××©×§×œ/×”×§××•×ª/××œ× ×”","×›××‘ ×‘×—×–×”"],
        "physical_exam": [{"label":"××™×©×•×© ×‘×˜×Ÿ ×•×”×¢×¨×›×ª ×¨×’×™×©×•×ª"}],
        "labs": [L("×œ×™×¤××–","×œ×‘×œ×‘"), L("Hb","×“×™××•× ×›×¨×•× ×™")],
        "imaging": [IMG("US/CT","×œ×¤×™ ×§×œ×™× ×™×§×”","ECG")]
    },

    # --- ×’× ×™×˜×•××•×¨×™× ×¨×™ ---
    "×“×™×–×•×¨×™×”/UTI": {
        "questions": ["×ª×›×™×¤×•×ª/×¦×¨×™×‘×”/×“×?", "×—×•×/×›××‘ ××•×ª× ×™/×‘×—×™×œ×•×ª?", "×”×¨×™×•×Ÿ/×¡×•×›×¨×ª/×§×˜×˜×¨?","×™×—×¡×™ ××™×Ÿ ×œ× ××•×’× ×™×","×”×¤×¨×©×” ×•×’×™× ××œ×™×ª/×¤×™×Ÿ"],
        "physical_exam": [{"label":"×¨×’×™×©×•×ª ×¡×•×¤×¨××¤×•×‘×™×ª"},{"label":"×¨×’×™×©×•×ª CVA"}],
        "labs": [L("×¡×˜×™×§ ×©×ª×Ÿ + ××™×§×¨×•","×œ×•×™×§×•×¦×™×˜×™×/× ×™×˜×¨×™×˜×™×/×“×"), L("×ª×¨×‘×™×ª ×©×ª×Ÿ","×× ×˜×™×‘×™×•×’×¨××”"), L("CBC/CRP","×—×•××¨×ª ×–×™×”×•×"), L("STD ×¤×× ×œ")],
        "imaging": [IMG("US ×›×œ×™×•×ª/×©×œ×¤×•×—×™×ª","Complicated/retention")]
    },
    "×›××‘ ××•×ª× ×™ - ×—×©×“ ×œ××‘×Ÿ": {
        "questions": ["×›××‘ ×”×ª×§×¤×™ ××§×¨×™×Ÿ ×œ××¤×©×¢×”", "×‘×—×™×œ×•×ª/×”××˜×•×¨×™×”", "××‘× ×™× ×‘×¢×‘×¨","×—×•×/×”×§××•×ª/×›××‘ ×‘×—×–×”],
        "physical_exam": [{"label":"×¨×’×™×©×•×ª CVA"}],
        "labs": [L("×©×ª×Ÿ ×›×œ×œ×™×ª ×•×ª×¨×‘×™×ª","×“×/×–×™×”×•×"), L("×§×¨×˜×™× ×™×Ÿ","×ª×¤×§×•×“×™ ×›×œ×™×”"),],
        "imaging": [IMG("CT low-dose","×¨×’×™×©×•×ª ×’×‘×•×”×”"), IMG("US","×‘×”×¨×™×•×Ÿ/×œ×”×™×× ×¢ ××§×¨×™× ×”"),IMG("ECG/POCUS","××¢×œ ×’×™×œ 50 ×¢× ×—×©×“ ×œ×“×™×¡×§×¦×™×”")]
    },
    "×©×œ×™×¤×ª ×§×˜×˜×¨ ×©×ª×Ÿ": {
        "questions": ["×–××Ÿ ×”×—×“×¨×” ×•×¡×™×‘×”", "×§×•×©×™ ×‘×”×˜×œ×”/×›××‘/×“×", "×–×™×”×•××™× ×§×•×“××™×"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ××–×•×¨ ×”×©×•×¤×›×” ×•×”×¤× ×™×¡/×¤×¨×™× ××•×"}],
        "labs": [],
        "imaging": [],
        "notes": ["××¡×¤×˜×™×§×”, ×ª×™××•× ××•×¨×•×œ×•×’×™ ×× ×§×•×©×™"]
    },
    "× ×¤×¨×•×¡×˜×•×": {
        "questions": ["×¡×™×‘×”/××•×¢×“ ×”×—×œ×¤×” ××—×¨×•×Ÿ/×—×•×/×›××‘ ×’×‘"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ××ª×¨ ×”× ×™×§×•×–"}],
        "labs": [L("×ª×¨×‘×™×ª ×©×ª×Ÿ/× ×•×–×œ ×× ×¤×¨×•×¡×˜×•×","×× ×”×¤×¨×©×”/×—×•×")]
    },
    "×œ×™×™×Ÿ ×“×™××œ×™×–×”": {
        "questions": ["×›××‘/××•×“×/×”×¤×¨×©×”/×—×•×", "××•×¢×“ ×“×™××œ×™×–×” ××—×¨×•×Ÿ"],
        "physical_exam": [{"label":"×”×¢×¨×›×ª ××ª×¨ ×”×§×˜×˜×¨/×¤×™×¡×˜×•×œ×”"}],
        "labs": [L("×ª×¨×‘×™×•×ª ×“×","×× ×—×•×")],
        "scores": [S("qSOFA","×¡×¤×¡×™×¡")]
    },

    # --- ×.×.×’ ×•×¢×™× ×™×™× ---
    "×“×™××•× ××¤×™ ×¡×¤×•× ×˜× ×™": {
        "questions": ["×©×™××•×© ×‘××“×œ×œ×™ ×“×","×—×“/×“×• ×¦×“×“×™, ×˜×¨××•××”/×—×™×˜×•×˜/××“×œ×œ×™×", "×™×ª×¨ ×œ\"×“?"],
        "physical_exam": [{"label":"×‘×“×™×§×” ×§×“××™×ª ×©×œ ××£/××•×–×Ÿ/×œ×•×¢"},{"label":"×˜××¤×•× ×“×” ×§×“××™×ª ×× ×¦×¨×™×š"}],
        "labs": [L("CBC","Hb"), L("×§×¨×™×©×”","INR/aPTT","××“×œ×œ×™×")]
    },
    "×›××‘ ×’×¨×•×Ÿ": {
        "questions": ["×—×•×/×“×™×¡×¤×’×™×”/×¨×™×— ×¨×¢/×¤×¨×™×—×”"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ×œ×•×¢ ×•×‘×œ×•×˜×•×ª"}],
        "labs": [L("Strep swab","×× ×—×©×“ ×¡×˜×¨×¤×˜×•×§×•×§"),L("CBC","×–×™×”×•× ××§×•×˜×™")]
    },
    "×›××‘ ××•×–×Ÿ": {
        "questions": ["×—×•×/×”×¤×¨×©×”/×™×¨×™×“×” ×‘×©××™×¢×”"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ×˜×™××¤×× ×•×"}]
    },
    "×’×•×£ ×–×¨ ×‘××£/××•×–×Ÿ/×œ×•×¢": {
        "questions": ["×¡×•×’ ×•×–××Ÿ, ×§×•×¦×¨ × ×©×™××”"],
        "physical_exam": [{"label":"×‘×“×™×§×” ×§×“××™×ª ×©×œ ××£/××•×–×Ÿ/×œ×•×¢"}],
        "imaging": [IMG("×¦×™×œ×•×","×œ×¤×™ ×¡×•×’")]
    },
    "Red eye": {
        "questions": ["×›××‘/×¤×•×˜×•×¤×•×‘×™×”/×”×¤×¨×©×•×ª/×¢×“×©×•×ª ××’×¢", "×˜×¨××•××”/×’×•×£ ×–×¨"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ×—×“×•×ª ×¨××™×™×”"},{"label":"×¤×œ×•××•×¨×¡×¦××™×Ÿ/×”×¤×™×›×ª ×¢×¤×¢×£"}],
        "notes": ["×¢×“×©×•×ª ××’×¢ - ×›×™×¡×•×™ ×¤×¡××•×“×•××•× ×¡"]
    },
    "×™×¨×™×“×” ×—×“×” ×‘×¨××™×™×”": {
        "questions": ["×¤×ª××•××™/×”×“×¨×’×ª×™, ×—×“/×“×• ×¢×™× ×™", "×•×™×œ×•×Ÿ ×©×—×•×¨/×¤×•×˜×•×¤×¡×™×•×ª", "×›××‘ ×¢×™× ×™"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ×—×“×•×ª ×¨××™×™×”"},{"label":"×©×“×•×ª ×¨××™×™×” ×•×ª× ×•×¢×•×ª ×¢×™× ×™×™×"}],
        "imaging": [IMG("OCT/US ×¢×™× ×™","×œ×¤×™ ×–××™× ×•×ª")]
    },
    "×’×•×£ ×–×¨ ×‘×¢×™×Ÿ": {
        "questions": ["××”×™×¨×•×ª/×—×•××¨, ×¢×“×©×•×ª ××’×¢"],
        "physical_exam": [{"label":"×¤×œ×•××•×¨×¡×¦××™×Ÿ/×”×¤×™×›×ª ×¢×¤×¢×£"}],
        "imaging": [IMG("×¦×™×œ×•×/CT ××¡×œ×•×œ","×—×©×“ ××ª×›×ª×™ ×—×“×™×¨")]
    },

    # --- ×× ×“×•×§×¨×™× ×™ ---
    "×”×™×¤×¨×’×œ×™×§××™×”": {
        "questions": ["×¤×•×œ×™××•×¨×™×”/×¤×•×œ×™×“×™×¤×¡×™×”/×™×¨×™×“×” ×‘××©×§×œ", "×‘×—×™×œ×•×ª/×›××‘×™ ×‘×˜×Ÿ/×™×©× ×•× ×™×•×ª (DKA/HHS)", "×–×™×”×•×? ×¡×˜×¨×•××™×“×™×? ×”×—××¦×ª ××™× ×¡×•×œ×™×Ÿ?"],
        "physical_exam": [{"label":"××“×“×™×"},{"label":"×”×ª×™×™×‘×©×•×ª/×˜×•×¨×’×•×¨"},{"label":"× ×©×™××•×ª ×§×•×¡×××œ"},{"label":"××™×©×•×© ×‘×˜×Ÿ ×•×”×¢×¨×›×ª ×¨×’×™×©×•×ª"}],
        "labs": [L("×’×œ×•×§×•×– ××™×™×“×™","××™×©×•×¨","××™×“×™"), L("BMP","××œ×§×˜×¨×•×œ×™×˜×™×/×›×œ×™×”"), L("VBG/ABG + pH","×—××¦×ª","×—×©×“ ×œ-DKA/HHS"), L("×§×˜×•× ×™× ×‘×“×/×©×ª×Ÿ","DKA"), L("CBC/CRP","××•×§×“ ×–×™×”×•××™"), L("××•×¡××•×œ×¨×™×•×ª","HHS"), L("ECG","Kâº ×—×¨×™×’")],
        "scores": [S("qSOFA","×× ×—×©×“ ×œ×–×™×”×•×")],
        "notes": ["×× DKA/HHS - × ×•×–×œ×™×, Kâº, ××™× ×¡×•×œ×™×Ÿ IV, ×˜×™×¤×•×œ ×‘××•×§×“"]
    },
    "×ª×™×¨×•×˜×•×§×¡×™×§×•×–×™×¡ ": {
        "questions": ["×™×¨×™×“×” ×‘××©×§×œ/×˜×›×™×§×¨×“×™×”/××™ ×©×§×˜/×–×™×¢×”", "×××™××•×“×¨×•×Ÿ/×œ×‘×•×ª×™×¨×•×§×¡×™×Ÿ/×™×•×“", "×¢×™×Ÿ ×’×¨×™×™×‘×¡, ×”×¨×™×•×Ÿ/×¤×•×¡×˜-×¤×¨×˜×•×"],
        "physical_exam": [{"label":"×“×•×¤×§/×œ\"×“/×˜××¤'"},{"label":"×¨×˜×™×˜×ª ××¦×‘×¢×•×ª ×“×§×” (fine tremor)"},{"label":"×‘×œ×•×˜×ª ×”×ª×¨×™×¡ - ×”×’×“×œ×”/×¨×’×™×©×•×ª/××™×•×•×©×”"},{"label":"×¢×™× ×™×™× - ×¤×¨×•×¤×˜×•×–×™×¡/×œ×’ ××•×¤×ª×œ××•×¡"}],
        "labs": [L("TSH","×¡×§×¨","××™×“×™"), L("FT4/FT3","××™×©×•×¨ ×™×ª×¨","TSH × ××•×š"), L("××œ×§×˜×¨×•×œ×™×˜×™×/×’×œ×•×§×•×–","×˜×¨×™×’×¨×™×"), L("×˜×¨×•×¤×•× ×™×Ÿ/BNP","××¢×•×¨×‘×•×ª ×œ×‘×‘×™×ª")],
        "imaging": [IMG("ECG","×˜×›×™×§×¨×“×™×”/×¤×œ×¤×™×˜×¦×™×•×ª"), IMG("US ×ª×™×¨×•××™×“","×§×©×¨×™×•×ª/×“×œ×§×ª"), IMG("RAIU/×¡×™× ×˜×™×’×¨×¤×™×”","××‘×—× ×ª ××§×•×¨")],
        "scores": [S("Burchâ€“Wartofsky","×¡×™×›×•×Ÿ ×œ××©×‘×¨ ×ª×™×¨×•×˜×•×§×¡×™","â‰¥45 ×¡×‘×™×¨ ×××•×“","<25 ×œ× ×¡×‘×™×¨")],
        "notes": ["×‘×œ×•×§×¨ ×‘×˜× ×œ×¤×™ ×”×ª×•×•×™×”; ×—×©×“ ×œ××©×‘×¨ - ×˜×™×¤×•×œ ×“×—×•×£"]
    },
    "××©×‘×¨ ××“×¨× ×œ×™": {
        "questions": ["×¡×˜×¨×•××™×“×™× ×›×¨×•× ×™×™×/×”×¤×¡×§×”", "×œ×—×¥/×–×™×”×•×/× ×™×ª×•×— ×œ××—×¨×•× ×”"],
        "physical_exam": [{"label":"×œ\"×“ × ××•×š/×©×•×§"},{"label":"×”×ª×™×™×‘×©×•×ª"}],
        "labs": [L("Naâº/Kâº/×’×œ×•×§×•×–","×”×™×¤×•× ×ª×¨××™×”/×”×™×¤×¨×§×œ××™×”/×”×™×¤×•×’×œ×™×§××™×”"), L("×§×•×¨×˜×™×–×•×œ","×œ×¤× ×™ ×¡×˜×¨×•××™×“×™× ×× ××¤×©×¨")]
    },

    # --- ×”××˜×•×œ×•×’×™×” / ×–×™×”×•××™×•×ª / ×›×œ×œ×™×•×ª / ×¢×•×¨ ---
    "×“×™××•× ×¡×¤×•× ×˜× ×™": {
        "questions": ["××™×§×•×/×›××•×ª/××©×š", "××“×œ×œ×™×/××—×œ×•×ª ×›×‘×“/×›×œ×™×”", "×¤×¦×™×¢×•×ª/×˜×¨××•××”","×”××˜×•××•×ª ×‘×’×¤×™×™×/×—×œ×œ ×”×¤×” /×œ×—××™×•×ª ×”×¢×™×Ÿ "],
        "physical_exam": [{"label":"×¡×™×× ×™ ×“×™××•× ×¢×•×¨×™×™×/×¨×™×¨×™×•×ª"}],
        "labs": [L("CBC","×˜×¡×™×•×ª/Hb"), L("PT/INR, aPTT","×§×¨×™×©×”"), L("×›×™××™×”/×›×‘×“","×¡×™×‘×” ××©× ×™×ª")]
    },
    "×“×™××•× ××¤×¦×¢": {
        "questions": ["××•×¢×“/× ×¡×™×‘×•×ª","×¡×˜×˜×•×¡ ×˜×˜× ×•×¡", "××“×œ×œ×™×", "×œ×—×¥ ×™×©×™×¨/×ª×¤×¨×™× ×§×™×™××™×"],
        "physical_exam": [{"label":"×”×¢×¨×›×ª ×¤×¦×¢ ×•×¢×•××§"}],
        "labs": [L("CBC","Hb"), L("×§×¨×™×©×”","INR/aPTT")]
    },
    "×—×•× ×œ× ×‘×¨×•×¨": {
        "questions": ["××©×š/×©×¢×•×ª/×¨×¢×“/××¡×¢×•×ª/×—×©×™×¤×•×ª/×—×™×•×ª/×× ×˜×™×‘×™×•×˜×™×§×”", "××—×œ×•×ª ×¨×§×¢ ×•×—×™×¡×•× ×™×"],
        "physical_exam": [{"label":"×‘×“×™×§×” ×©×™×˜×ª×™×ª ××œ××”"}],
        "labs": [L("CBC, CRP","×“×œ×§×ª/×–×™×”×•×"), L("×ª×¨×‘×™×•×ª ×“× x2","×× ×—×•× ×’×‘×•×”/×¡×¤×¡×™×¡"), L("×©×ª×Ÿ ×›×œ×œ×™×ª ×•×ª×¨×‘×™×ª","××•×§×“"), L("×›×™××™×”/×ª×¤×§×•×“×™ ×›×‘×“","××•×§×“")],
        "imaging": [IMG("×¦×™×œ×•× ×—×–×”","××•×§×“ × ×©×™××ª×™")],
        "scores": [S("qSOFA","×¡×¤×¡×™×¡")]
    },
    "× ×©×™×›×ª ×›×œ×‘": {
        "questions": ["××ª×™ × × ×©×š? ×‘×¢×œ ×—×™×™× ××•×›×¨? ×—×™×¡×•×Ÿ ×›×œ×‘×ª? ××™×§×•× ×”×¤×¦×¢ ×•×¢×•××§×•? ×“×™×›×•×™ ×—×™×¡×•×Ÿ?"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ×–×™×”×•× ×¨×§××•×ª ×¨×›×•×ª (×¦×œ×•×œ×™×˜×™×¡/××‘×¦×¡)"},{"label":"×”×¢×¨×›×ª ×¢×•×¨ - ××•×¨×¤×•×œ×•×’×™×” ×•×”×ª×¤×©×˜×•×ª"}],
        "labs": [L("CBC","×œ×•×™×§×•×¦×™×˜×•×–×™×¡","×× ×—×•×/××•×“×/× ×¤×™×—×•×ª"), L("CRP","×“×œ×§×ª","×—×©×“ ×œ×¦×œ×•×œ×™×˜×™×¡")],
        "imaging": [IMG("×¦×™×œ×•×","×—×©×“ ×œ×©×Ÿ/×’×•×£ ×–×¨/×—×“×™×¨×” ×¢××•×§×”")],
        "scores": [S("qSOFA","×¡×¤×¡×™×¡")],
        "notes": ["× ×™×§×•×™ 10â€“15 ×“×§', ×”×˜×¨×™×” ×¢×“×™× ×”, ×× ×˜×™×‘×™×•×˜×™×§×” ××ª××™××”", "PEP ×›×œ×‘×ª ×œ×¤×™ ×œ×©×›×ª ×‘×¨×™××•×ª", "×˜×˜× ×•×¡ ×œ×¤×™ ×¡×˜×˜×•×¡"]
    },
    "×¤×¨×™×—×” ×‘×¢×•×¨": {
        "questions": ["××©×š/×”×—××¨×”, ×’×¨×“/×›××‘","×¤×’×™×¢×ª ×‘×¢×œ ×—×™×™× ×¢×§×™×¦×”/× ×©×™×›×” ","×—×–×¨×” ××—×•×¥ ×œ××¨×¥", "×—×•×/×ª×¨×•×¤×•×ª ××• ×—×•××¨ ×—×“×©×•×ª/×—×©×™×¤×•×ª"],
        "physical_exam": [{"label":"×”×¢×¨×›×ª ×¢×•×¨ - ××•×¨×¤×•×œ×•×’×™×” ×•×”×ª×¤×©×˜×•×ª"}],
        "labs": []
    },
    "××‘×¦×¡/×¦×œ×•×œ×™×˜×™×¡": {
        "questions": ["××©×š/×›××‘/×—×•× ××§×•××™ ××• ×¡×™×¡×˜××™", "××—×œ×ª ×¨×§×¢/×“×™×›×•×™ ×—×™×¡×•×Ÿ"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ×–×™×”×•× ×¨×§××•×ª ×¨×›×•×ª (×¦×œ×•×œ×™×˜×™×¡/××‘×¦×¡)"}],
        "labs": [L("CBC, CRP","×“×œ×§×ª/×–×™×”×•×","×× ×—×•×/×¦×œ×•×œ×™×˜×™×¡")],
        "imaging": [IMG("US ×¨×š","×—×©×“ ×œ××‘×¦×¡")]
    },

    # --- ×©×¨×™×¨-×©×œ×“ / ×˜×¨××•××” / ×—×™×¨×•× ×›×œ×œ×™ ---
    "×›××‘ ×’×‘ ×ª×—×ª×•×Ÿ": {
        "questions": ["red flags: ×—×•×/×™×¨×™×“×” ×‘××©×§×œ/×—×¡×š × ×•×™×¨×•×œ×•×’×™ /××™ ×©×œ×™×˜×” ×‘×¡×•×’×¨×™×/ ×’×¨×™×¨×ª ×¨×’×œ ", "×˜×¨××•××”/×¤×¢×™×œ×•×ª ×—×¨×™×’×”"],
        "physical_exam": [{"label":"×‘×“×™×§×” × ×•×™×¨×•×œ×•×’×™×ª ×××•×§×“×ª"}],
        "labs": [],
        "imaging": [IMG("MRI/CT","red flags/×—×©×“ ×“×—×•×£")]
    },
    "×›××‘ ×¦×•×•××¨": {
        "questions": ["×˜×¨××•××”/×”×§×¨× ×” ×œ×™×“/× ×•×™×¨×•"],
        "physical_exam": [{"label":"×‘×“×™×§×” × ×•×™×¨×•×œ×•×’×™×ª ×××•×§×“×ª"}],
        "labs": []
        "imaging": [IMG("CT/XRAY","×¢××•×“ ×©×“×¨×” ×¦×•×•××¨×™")]
    },
    "×›××‘ ××¤×¨×§ ×—×“": {
        "questions": ["×˜×¨××•××”/×—×•×/×¤×¨×•×¦×“×•×¨×”", "Gout/Pseudogout ×‘×¢×‘×¨"],
        "physical_exam": [{"label":"×‘×“×™×§×ª ××¤×¨×§: ×—×•×/× ×¤×™×—×•×ª/×˜×•×•×—"}],
        "labs": [L("×—×•××¦×” ×××•×¨×™×ª,CBC, CRP","×“×œ×§×ª"), L("×©××™×‘×ª × ×•×–×œ","×§×¨×™×¡×˜×œ×™×/×ª×¨×‘×™×ª")],
        "imaging": [IMG("×¦×™×œ×•× ××¤×¨×§","×œ×©×‘×¨/××¨×ª×¨×•×–×™×¡")]
    },
    "×”×ª×™×™×‘×©×•×ª": {
        "questions": ["×¦×¨×™×›×” ×ª×¨×•×¤×•×ª/×©×™××•×© ×‘×¡×™× ××• ××œ×›×”×•×œ /×©×œ×©×•×œ/×”×§××•×ª/×—×•×", "×ª×¨×•×¤×•×ª ××©×ª× ×•×ª"],
        "physical_exam": [{"label":"×”×ª×™×™×‘×©×•×ª/×˜×•×¨×’×•×¨"},{"label":" ××“×“×™× ×•×—×•× ×¨×§×˜××œ×™ "}],
        "labs": [L("BMP","××•×¨××”/×§×¨×˜× ×™×Ÿ,××œ×‘×•××™×Ÿ/Na/K"), L("Hb","×”××•×§×•× ×¡× ×˜×¨××¦×™×”")]
    },
    "×œ×—×¥ ×“× × ××•×š/×©×•×§": {
        "questions": ["×—×•×/×–×™×”×•×/×“×™××•×/××œ×¨×’×™×”/×˜×¨××•××”", "× ×•×–×œ×™×/×ª×¨×•×¤×•×ª"],
        "physical_exam": [{"label":"××“×“×™× ×•×©×•×§"},{"label":"×‘×“×™×§×” ×©×™×˜×ª×™×ª ××œ××”"}],
        "labs": [L("CBC","Hb/×œ×•×™×§×•×¦×™×˜×™×"), L("BMP","×›×œ×™×”/××œ×§×˜×¨×•×œ×™×˜×™×"), L("×œ×§×˜×˜","×”×™×¤×•×¤×¨×¤×•×–×™×”"), L("×ª×¨×‘×™×•×ª ×“×","×× ×—×•×")],
        "imaging": [IMG("POCUS ×œ×‘/×¨×™××•×ª","×”×›×•×•× ×ª ×“×™×¤×¨× ×¦×™××œ")],
        "scores": [S("qSOFA","×¡×¤×¡×™×¡")]
    },
    "×”×¨×¢×œ×ª ××•×¤×™××˜×™× ×—×©×“": {
        "questions": ["×©×™××•×© ×œ××—×¨×•× ×”/×ª×¨×•×¤×•×ª ×–××™× ×•×ª", "××œ×›×•×”×•×œ/×¡××™× × ×•×¡×¤×™×"],
        "physical_exam": [{"label":"×¡×˜×•×¨×¦×™×” ×•-RR,×‘×“×™×§×ª ××™×©×•× ×™×"}],
        "labs": [],
        ,"imaging": [IMG("ECG/")]
        "notes": ["× ×œ×•×§×¡×•×Ÿ ×œ×¤×™ ×¦×•×¨×š, × ×™×˜×•×¨ × ×©×™××ª×™"]
    },
    "××›×ª ×—×•×": {
        "questions": ["×—×©×™×¤×” ×œ×—×•×/××××¥", "×ª×¨×•×¤×•×ª × ×•×’×“×•×ª ×›×•×œ×™× ×¨×’×™/× ×•×™×¨×•×œ×¤×˜×™"],
        "physical_exam": [{"label":"××“×“×™×, ×˜××¤' ×’×‘×•×”×”"}],
        "labs": [L("CK","Rhabdo"), L("BMP","××œ×§×˜×¨×•×œ×™×˜×™×/×›×œ×™×”")],
        "notes": ["×§×™×¨×•×¨ ××§×˜×™×‘×™ ××”×™×¨ + × ×•×–×œ×™×"]
    },
}

# ×¦×¨×£ ×§×™×©×•×¨×™ ×•×™×“××• ××•×˜×•××˜×™×ª ×œ×›×œ ×ª×œ×•× ×”
for blk in COMPLAINTS.values():
    attach_video_links(blk)

# ========================= UI =========================
st.title("ğŸ©º Smart Anamnesis â€“ ×ª×œ×•× ×•×ª (×œ×œ× ×—×œ×•×§×” ×œ××¢×¨×›×•×ª)")
st.caption(f"×¡×”\"×› ×ª×œ×•× ×•×ª ××•×’×“×¨×•×ª: {len(COMPLAINTS)}")
st.markdown("<div class='hr'></div>", unsafe_allow_html=True)

names = sorted(COMPLAINTS.keys())
search = st.text_input("×—×¤×© ×ª×œ×•× ×”", placeholder="×›××‘ ×—×–×”, ×¡×—×¨×—×•×¨×ª, UTI...").strip()
if search:
    names = [n for n in names if search in n]
st.caption(f"× ××¦××• {len(names)} ×ª×œ×•× ×•×ª")

# ×‘×—×™×¨×” ××”×™×¨×” + '×¤×ª×— ×”×›×•×œ'
c0, c1 = st.columns([2,1])
with c0:
    sel = st.selectbox("×‘×—×¨ ×ª×œ×•× ×” ×œ×”×¦×’×”", ["â€”"] + names, index=0)
with c1:
    open_all = st.toggle("×¤×ª×— ×”×›×•×œ", value=(len(names) <= 3))

def render_questions(qs: List[str]) -> None:
    st.markdown("#### ×× ×× ×–×” - ××” ×œ×©××•×œ")
    if not qs: st.write("- ××™×Ÿ ×©××œ×•×ª ××•×’×“×¨×•×ª"); return
    for q in qs: st.write(f"- {q}")

def render_list_with_links(items: Any, title: str) -> None:
    st.markdown(f"#### {title}")
    if not items: st.write("- ××™×Ÿ ×¤×¨×™×˜×™×"); return
    for item in items:
        if isinstance(item, dict) and "label" in item:
            label = item.get("label",""); url = item.get("url","")
            st.markdown(f"- {'â–¶ï¸ ' if url else ''}[{label}]({url})" if url else f"- {label}")
        elif isinstance(item, dict) and "test" in item:
            test=item.get("test",""); why=item.get("why",""); when=item.get("when","")
            line=f"- **{test}**"; 
            if why: line+=f" â€” ×œ××”: {why}"
            if when: line+=f" â€” ××ª×™: {when}"
            st.markdown(line)
        elif isinstance(item, dict) and "modality" in item:
            modality=item.get("modality",""); trig=item.get("trigger","")
            st.markdown(f"- **{modality}**" + (f" â€” ××ª×™: {trig}" if trig else ""))
        else:
            st.markdown(f"- {str(item)}")

def render_scores(scores: Any) -> None:
    st.markdown("#### ğŸ“Š SCORES ×¨×œ×•×•× ×˜×™×™×")
    if not scores: st.write("- ××™×Ÿ scores ××•×’×“×¨×™×"); return
    for s in scores:
        name = (s.get("name") if isinstance(s, dict) else str(s)) or ""
        st.markdown(f"- **{name}**")

def render_block(name: str, blk: Dict[str,Any], expand: bool=False) -> None:
    with st.expander(f"â€¢ {name}", expanded=expand):
        st.markdown("<div class='card'>", unsafe_allow_html=True); render_questions(blk.get("questions", [])); st.markdown("</div>", unsafe_allow_html=True)
        c1,c2,c3 = st.columns(3, gap="large")
        with c1:
            st.markdown("<div class='card'>", unsafe_allow_html=True)
            render_list_with_links(blk.get("physical_exam", []), "ğŸ§â€â™‚ï¸ ××” ×œ×‘×“×•×§ (×‘×“×™×§×” ×’×•×¤× ×™×ª)")
            st.markdown("</div>", unsafe_allow_html=True)
        with c2:
            st.markdown("<div class='card'>", unsafe_allow_html=True)
            render_list_with_links(blk.get("labs", []), "ğŸ§ª ××¢×‘×“×”")
            st.markdown("</div>", unsafe_allow_html=True)
        with c3:
            st.markdown("<div class='card'>", unsafe_allow_html=True)
            render_list_with_links(blk.get("imaging", []), "ğŸ–¥ï¸ ×”×“××™×”")
            st.markdown("</div>", unsafe_allow_html=True)

        if blk.get("notes"):
            st.markdown("<div class='hr'></div>", unsafe_allow_html=True)
            st.markdown("#### ğŸ§´ ×”×¢×¨×•×ª ×•×”××œ×¦×•×ª")
            st.markdown("<div class='card'>", unsafe_allow_html=True)
            for n in blk["notes"]: st.write(f"- {n}")
            st.markdown("</div>", unsafe_allow_html=True)

        st.markdown("<div class='hr'></div>", unsafe_allow_html=True)
        st.markdown("<div class='card'>", unsafe_allow_html=True); render_scores(blk.get("scores", [])); st.markdown("</div>", unsafe_allow_html=True)

# ×”×¦×’×”
if sel != "â€”":
    render_block(sel, COMPLAINTS[sel], expand=True)

if open_all or sel == "â€”":
    for n in names:
        render_block(n, COMPLAINTS[n], expand=open_all and sel=="â€”")

st.markdown("<br>", unsafe_allow_html=True)
st.caption("Smart Anamnesis â€¢ ×”×ª×•×›×Ÿ ×œ×”×›×•×•× ×” ×§×œ×™× ×™×ª ×‘×œ×‘×“ ×•××™× ×• ××—×œ×™×£ ×©×™×§×•×œ ×“×¢×ª ×¨×¤×•××™.× ×›×‘×ª ×¢×™ ×œ×™×¨×Ÿ ×©×—×¨")


