from pathlib import Path
import json

BASE = Path(__file__).parent
KNOW_PATH = BASE / "knowledge.json"
VID_PATH  = BASE / "video_links.json"

def L(test, why="", when=""):
    out = {"test": test}
    if why:  out["why"] = why
    if when: out["when"] = when
    return out

def IMG(modality, trigger):
    return {"modality": modality, "trigger": trigger}

def S(name, about, rule_in="", rule_out="", ref=""):
    out = {"name": name, "about": about}
    if rule_in:  out["rule_in"]  = rule_in
    if rule_out: out["rule_out"] = rule_out
    if ref:      out["ref"]      = ref
    return out

# ----------------------------------------------------------------
# MASTER KNOWLEDGE - תכולה מלאה לעריכה בהמשך
# ----------------------------------------------------------------
KNOWLEDGE = {
  "metadata": {"version": "1.0.0", "language": "he", "notes": "גרסת בסיס רחבה. עריכה חופשית בהמשך."},

  # תבניות גנריות לכל מערכת - משמשות ל"אחר"
  "generic_by_system": {
    "לב וכלי דם": {
      "questions": [
        "מתי התחילה הבעיה והאם יש החמרה?",
        "כאב חזה/קוצר נשימה/סינקופה/פלפיטציות?",
        "רקע: מחלת לב, יל\"ד, סוכרת, עישון, תרופות חדשות?"
      ],
      "physical_exam": [
        {"label": "מדדים חיוניים (דופק, ל\"ד, סטורציה, חום)"},
        {"label": "האזנה ללב (קצב/אוושות)"},
        {"label": "האזנה לריאות (קראקלס)"},
        {"label": "JVP ובצקות היקפיות"}
      ],
      "labs": [
        L("ECG","איסכמיה/קצב","כמעט תמיד"),
        L("BMP (Na⁺, K⁺, Cr)","אלקטרוליטים/כליה"),
        L("CBC","אנמיה/זיהום"),
        L("טרופונין","נזק מיוקרד","כאבי חזה/חשד ל-ACS")
      ],
      "imaging": [IMG("Echo לב","חשד לפגיעה תפקודית/מבנית"), IMG("צילום חזה","גודש/תפליט")],
      "scores": [S("HEART","סיכון ל-ACS","≥7 גבוה","0-3 נמוך"), S("GRACE","פרוגנוזה ב-ACS")],
      "notes": []
    },

    "נשימה": {
      "questions": ["פתאומי או הדרגתי? מאמץ/מנוחה?","שיעול/כיח/חום/כאב פלאוריטי?","COPD/אסתמה/אי ספיקת לב/עישון?"],
      "physical_exam": [{"label":"סטורציה ו-RR"},{"label":"האזנה לריאות - צפצופים/קראקלס"},{"label":"שימוש בשרירי עזר/כיחלון"}],
      "labs": [L("ABG/VBG","אוורור/חמצון","מצוקה"), L("CBC, CRP","זיהום/דלקת"), L("BMP","אלקטרוליטים")],
      "imaging": [IMG("צילום חזה","קו ראשון"), IMG("CT אנגיו חזה","חשד ל-PE")],
      "scores": [S("Wells - PE","הסתברות ל-PE","CTA אם בינוני/גבוה","PERC בסיכון נמוך")],
      "notes": []
    },

    "מערכת עצבים": {
      "questions": ["פתאומי/הדרגתי?","חסר נוירולוגי - דיבור/ראייה/תחושה/שיווי משקל?","פרכוס/טראומה/תרופות?"],
      "physical_exam": [{"label":"מדדים + גלוקוז מיידי"},{"label":"בדיקה נוירולוגית ממוקדת/עצבי גולגולת"}],
      "labs": [L("CBC, BMP, גלוקוז","בסיסי","מידי")],
      "imaging": [IMG("CT ראש ללא ניגוד","חשד לשבץ/דימום/טראומה")],
      "scores": [S("NIHSS","חומרת חסר")],
      "notes": []
    },

    "עיכול": {
      "questions": ["מיקום/משך/אופי/מחמיר/מקַל","בחילות/הקאות/שלשול/דם בצואה","ניתוחים בעבר/תרופות/הריון?"],
      "physical_exam": [{"label":"מישוש בטן והערכת רגישות"},{"label":"סימני גירוי צפקי וריבאונד"},{"label":"סימן מרפי"}],
      "labs": [
        L("CBC","לויקוציטוזיס/אנמיה"),
        L("BMP","אלקטרוליטים/כליה","התייבשות/הקאות"),
        L("CRP","דלקת"),
        L("ליפאז","לבלב","כאב עליון"),
        L("אנזימי כבד","כולסטטי מול הפטוצלולרי","RUQ"),
        L("β-hCG","שלילת הריון","נשים בגיל הפוריות")
      ],
      "imaging": [IMG("US בטן/אגן","קו ראשון"), IMG("CT בטן אגן עם ניגוד","חשד לסיבוך/כאב משמעותי")],
      "scores": [S("Alvarado","אפנדיציטיס","≥7 תומך","<5 מפחית")],
      "notes": []
    },

    "שתן/גניטואורינרי": {
      "questions": ["דיזוריה/תכיפות/השתנה לילית?","חום/צמרמורות/כאב מותני?","פרוצדורות/אבנים/הריון?"],
      "physical_exam": [{"label":"רגישות סופראפובית"},{"label":"רגישות CVA"}],
      "labs": [L("שתן כללית ותרבית","אבחנה ופתוגן","חשד ל-UTI"), L("CBC, CRP","חומרת זיהום","חום/סיבוך"), L("BMP","כליה","חשד לפגיעה כלייתית/ספסיס")],
      "imaging": [IMG("US כליות/דרכי שתן","חשד לאבן/חסימה")],
      "scores": [S("qSOFA","ספסיס","≥2 סיכון גבוה","0-1 לא שולל")],
      "notes": []
    },

    "א.א.ג": {
      "questions": ["מועד התחלה, צד, טראומה/חיטוט?","מדללי דם, ל\"ד?","גוף זר/דימום ממושך?"],
      "physical_exam": [{"label":"בדיקה קדמית של אף/אוזן/לוע"},{"label":"טמפונדה קדמית אם צריך"}],
      "labs": [L("CBC","אנמיה/זיהום","דימום משמעותי"), L("PT/INR, aPTT","קרישה/מדללים","לפי צורך")],
      "imaging": [],
      "scores": [],
      "notes": []
    },

    "עור / טראומה": {
      "questions": ["התחלה/החמרה, כאב/גרד?","אדמומיות/חום/נפיחות/הפרשה?","חשיפה - חיות/עקיצות/חומרים/טראומה?"],
      "physical_exam": [{"label":"הערכת עור - מורפולוגיה והתפשטות"},{"label":"בדיקת זיהום רקמות רכות (צלוליטיס/אבצס)"}],
      "labs": [L("CBC, CRP","דלקת/זיהום","אם חום/צלוליטיס")],
      "imaging": [IMG("US רך","חשד לאבצס")],
      "scores": [],
      "notes": []
    },

    "עיניים": {
      "questions": ["חד או דו עיני? פתאומי/הדרגתי?","כאב/פוטופוביה/הפרשות? עדשות מגע?"],
      "physical_exam": [{"label":"בדיקת חדות ראייה"},{"label":"שדות ראייה ותנועות עיניים"},{"label":"הפיכת עפעף ופלואורסצאין"}],
      "labs": [],
      "imaging": [],
      "scores": [],
      "notes": []
    },

    "שריר שלד": {"questions":["טראומה? נפיחות? נוקשות?"],"physical_exam":[],"labs":[],"imaging":[],"scores":[],"notes":[]},
    "אנדוקריני": {"questions":["תסמיני היפר/היפותירואידיזם? סכרת? סטרואידים?"],"physical_exam":[],"labs":[],"imaging":[],"scores":[],"notes":[]},
    "המטולוגי": {"questions":["דימומים/חבלות/תרופות מדללות?"],"physical_exam":[],"labs":[],"imaging":[],"scores":[],"notes":[]},
    "נשים ומיילדות": {"questions":["הריון? LMP? דימום? כאבי אגן?"],"physical_exam":[],"labs":[],"imaging":[],"scores":[],"notes":[]},
    "פסיכיאטריה": {"questions":["מצב רוח, חרדה, SI/HI, שימוש בחומרים?"],"physical_exam":[],"labs":[],"imaging":[],"scores":[],"notes":[]},
    "זיהומיות/כללי": {"questions":["חום, מסעות, חשיפות, אנטיביוטיקה לאחרונה?"],"physical_exam":[],"labs":[],"imaging":[],"scores":[],"notes":[]}
  },

  # פר תלונה
  "systems": {
    # ---------------- לב וכלי דם ----------------
    "לב וכלי דם": {
      "כאב בחזה": {
        "questions": ["מתי התחיל, אופי והקרנה", "טריגר - מאמץ/מנוחה/לאחר אוכל", "הזעה/בחילה/קוצר נשימה"],
        "physical_exam": [
          {"label": "האזנה ללב ולריאות"},
          {"label": "JVP ובצקות"},
          {"label": "מישוש דופן חזה"}
        ],
        "labs": [
          L("טרופונין סדרתי","אבחנת ACS","מידי"),
          L("BMP, גלוקוז","אלקטרוליטים/כליה"),
          L("CBC, קרישה","אנמיה/לפני התערבות")
        ],
        "imaging": [
          IMG("ECG מיידי","לכל כאב חזה חריג"),
          IMG("צילום חזה","חשד ריאתי/לבבי")
        ],
        "scores": [
          S("HEART","סיכון ל-ACS","≥7 גבוה","0-3 נמוך"),
          S("Wells/PERC ל-PE","הסתברות ל-PE","CTA אם בינוני/גבוה","PERC לשלילה בסיכון נמוך")
        ],
        "notes": []
      },

      "דפיקות לב": {
        "questions": ["פתאומי/הדרגתי, משך", "קצב סדיר/לא סדיר", "טריגרים - קפה/אלכוהול/מאמץ/לחץ", "סינקופה/קוצר נשימה/כאב"],
        "physical_exam": [{"label":"מדדים וסטורציה"},{"label":"האזנה ללב"}],
        "labs": [L("TSH, T4","תירוטוקסיקוזיס"), L("אלקטרוליטים כולל Mg","עוררות קצב"), L("CBC","אנמיה")],
        "imaging": [IMG("ECG 12 לידים","בעת תלונה"), IMG("Holter 24-48h","תלונות התקפיות")],
        "scores": [S("CHADS2-VASc","סיכון תרומבואמבולי בפרפור","גבוה - אנטיקואגולציה","0 בגבר לרוב ללא"), S("EHRA","חומרת תסמינים")],
        "notes": []
      },

      "בצקות ברגליים": {
        "questions": ["פתאומי/הדרגתי, חד/דו צדדי", "קוצר נשימה/עלייה במשקל/דיורזיס ירוד", "תרופות חדשות - CCB/NSAIDs/סטרואידים", "אי ספיקת לב/כליות/כבד", "כאב/חום מקומי/שינוי צבע - חשד ל-DVT"],
        "physical_exam": [{"label":"JVP"},{"label":"האזנה ללב (S3/אוושות)"},{"label":"האזנה לריאות (קראקלס)"},{"label":"בדיקת גפיים - סימטריה/חום/רגישות"}],
        "labs": [L("BNP/NT-proBNP","אי ספיקת לב","בכל חשד"), L("BMP","כליה/אלקטרוליטים","מקרה חדש"), L("תפקודי כבד + אלבומין","צירוזיס/מיימת"), L("CBC","אנמיה/זיהום")],
        "imaging": [IMG("ECG","קצב/עומס"), IMG("Echo לב","EF ולחץ ריאתי"), IMG("US ורידים תחתונים","בצקת חד צדדית")],
        "scores": [S("Framingham HF","קריטריונים ל-HF","≥2 גדולים","היעדרם לא שולל"), S("NYHA","דרגת תפקוד"), S("Wells DVT","סיכון ל-DVT","≥2 - US","<2 + D-dimer שלילי")],
        "notes": []
      },

      "סינקופה": {
        "questions": ["נסיבות האירוע, טריגרים, פרודרום", "אורך אובדן הכרה, התאוששות", "רקע לבבי/קוצב/תרופות"],
        "physical_exam": [{"label":"מדדים כולל ל\"ד בעמידה"},{"label":"האזנה ללב"},{"label":"בדיקה נוירולוגית קצרה"}],
        "labs": [L("ECG","Arrhythmia/בלוק"), L("גלוקוז","היפוגליקמיה"), L("Hb","אנמיה קשה")],
        "imaging": [IMG("Echo","אם חשד מבני"), IMG("מוניטור/הולטר","אירועים חוזרים")],
        "scores": [S("San Francisco Syncope","סיכון לאירוע חמור","נוכחות קריטריון מעלה סיכון","היעדר לא שולל")],
        "notes": []
      }
    },

    # ---------------- נשימה ----------------
    "נשימה": {
      "קוצר נשימה": {
        "questions": ["פתאומי/הדרגתי? מנוחה/מאמץ?", "חום/כאב פלאוריטי/המופטיזיס/צפצופים", "PE risks: ניתוח/Immobilization/סרטן/הריון"],
        "physical_exam": [{"label":"סטורציה, RR, מאמץ נשימתי"},{"label":"האזנה - צפצופים/קראקלס"},{"label":"JVP/בצקות"}],
        "labs": [L("ABG/VBG","אוורור/חמצון","מצוקה"), L("CBC, CRP","זיהום/דלקת"), L("BMP","אלקטרוליטים"), L("BNP/NT-proBNP","HF"), L("D-dimer","PE","סיכון נמוך/בינוני")],
        "imaging": [IMG("צילום חזה","קו ראשון"), IMG("CT אנגיו חזה","Wells בינוני/גבוה או D-dimer חיובי"), IMG("POCUS לב/ריאות","סיוע לדיפרנציאל")],
        "scores": [S("Wells - PE","הסתברות ל-PE","CTA אם בינוני/גבוה","PERC לשלילה בסיכון נמוך"), S("PERC","שלילת PE בסיכון נמוך","","כל הקריטריונים שליליים")],
        "notes": []
      },

      "שיעול": {
        "questions": ["יבש/ליחתי, משך, חום, המופטיזיס?", "חשיפה לעישון/סביבה?"],
        "physical_exam": [{"label":"האזנה לריאות"}],
        "labs": [L("CRP, CBC","זיהום","לפי קליניקה")],
        "imaging": [IMG("צילום חזה","ממושך או חמור")],
        "scores": []
      },

      "המופטיזिस": {
        "questions": ["כמות/קרישי דם/משך", "Dyspnea/כאב פלאוריטי", "TB/ממאירות/קרישיות?"],
        "physical_exam": [{"label":"סטורציה ומאמץ נשימתי"},{"label":"האזנה/מוקדי חיכוך"}],
        "labs": [L("CBC","Hb/לויקוציטים"), L("קרישה","INR/aPTT"), L("סוג והצלבה","Massive")],
        "imaging": [IMG("צילום חזה","קו ראשון"), IMG("CTA חזה","חשד ל-PE/דימום פעיל")],
        "scores": []
      }
    },

    # ---------------- מערכת עצבים ----------------
    "מערכת עצבים": {
      "חולשת צד / חשד לשבץ": {
        "questions": ["זמן אחרון תקין (LKW)", "תסמיני NIHSS - דיבור/ראייה/גפה/פנים", "אנטיקואגולציה/דימום/טראומה?"],
        "physical_exam": [{"label":"גלוקוז מיידי"},{"label":"NIHSS קצר"},{"label":"לחץ דם"}],
        "labs": [L("CBC, קרישה, BMP","לפני טיפול תרופתי/פרוצדורות")],
        "imaging": [IMG("CT ראש ללא ניגוד","דימום"), IMG("CTA ראש-צוואר","חשד ל-LVO")],
        "scores": [S("NIHSS","חומרת חסר","גבוה - הסלמה")],
        "notes": ["לפי פרוטוקול שבץ מקומי"]
      },

      "TIA - תסמינים שחלפו": {
        "questions": ["משך אירוע, תדירות", "גורמי סיכון - יל\"ד/AF/DM/עישון", "אזהרות - Amaurosis fugax"],
        "physical_exam": [{"label":"בדיקה נוירולוגית מלאה"},{"label":"קרדיווסקולרי בסיסי"}],
        "labs": [L("גלוקוז, ליפידים, HbA1c","סיכון קרדיו-וסקולרי")],
        "imaging": [IMG("CTA/US קרוטידים","מקור אמבולי"), IMG("MRI דיפוזיה","אוטמים עדינים")],
        "scores": [S("ABCD2","סיכון לשבץ מוקדם","≥4 בינוני-גבוה")],
        "notes": []
      },

      "סחרחורת": {
        "questions": ["ספינים/אי יציבות? התקפי/מתמשך?", "שמיעה/טינטון/נוירו נוספים?"],
        "physical_exam": [{"label":"Dix-Hallpike"},{"label":"בדיקת ניסטגמוס"}],
        "labs": [L("גלוקוז","היפוגליקמיה"), L("אלקטרוליטים","דיסהרמיה")],
        "imaging": [IMG("MRI מוח","חשד מרכזי/סימנים פוקליים")],
        "scores": [S("HINTS (למיומנים)","פריפרי מול מרכזי","Head-Impulse תקין/Skew","לא למתחילים")],
        "notes": []
      },

      "כאב ראש": {
        "questions": ["thunderclap? החמרה חדשה?", "פוטופוביה/בחילה/נוירו פוקלי", "דלקת כלי דם/הריון/מדללים?"],
        "physical_exam": [{"label":"בדיקה נוירולוגית מלאה"},{"label":"עורף - נוקשות"}],
        "labs": [L("CRP/ESR","Temporal arteritis >50y"), L("β-hCG","נשים בגיל הפוריות")],
        "imaging": [IMG("CT ראש","red flags"), IMG("CTA/CTV","חשד ל-SAH/תרומבוזיס ורידי")],
        "scores": []
      }
    },

    # ---------------- עיכול ----------------
    "עיכול": {
      "בחילות/הקאות": {
        "questions": ["משך, יכולת שתיה/אכילה", "דם בקיא/מרה/עצירות", "תרופות/הריון"],
        "physical_exam": [{"label":"סימני התייבשות"},{"label":"הערכת בטן"}],
        "labs": [L("BMP","אלקטרוליטים/כליה"), L("גלוקוז","DKA?"), L("β-hCG","נשים בגיל הפוריות")],
        "imaging": [IMG("US/CT","לפי קליניקה")],
        "scores": []
      },

      "כאב ברביע ימני עליון": {
        "questions": ["קוליקי/לא קוליקי, לאחר אוכל שמן", "חום/צהבת/הקאות"],
        "physical_exam": [{"label":"סימן מרפי"},{"label":"רגישות RUQ"}],
        "labs": [L("אנזימי כבד","כולסטטי/הפטוצלולרי"), L("ליפאז","דיפרנציאל לבלב"), L("CBC, CRP","דלקת")],
        "imaging": [IMG("US כיס מרה/דרכי מרה","קו ראשון"), IMG("MRCP/ERCP","חשד לאבן ב-CBD")],
        "scores": []
      },

      "RLQ - חשד לאפנדיציטיס": {
        "questions": ["מעבר כאב מאיפיגסטריום ל-RLQ", "חום/אנורקסיה/בחילה"],
        "physical_exam": [{"label":"רגישות מקברני"},{"label":"ריבאונד/גירוי צפקי"}],
        "labs": [L("CBC","לויקוציטוזיס"), L("CRP","דלקת")],
        "imaging": [IMG("US/CT","לפי BMI וגיל")],
        "scores": [S("Alvarado","אפנדיציטיס","≥7 תומך","<5 מפחית")]
      },

      "דימום רקטלי": {
        "questions": ["כמות/צבע/כאב/עצירות", "מדללים/IBD/שחין"],
        "physical_exam": [{"label":"בדיקת PR"},{"label":"סימני היפוולמיה"}],
        "labs": [L("CBC","Hb"), L("קרישה","INR/aPTT"), L("סוג והצלבה","דימום משמעותי")],
        "imaging": [IMG("קולונוסקופיה/CT אנגיו","לפי יציבות")],
        "scores": []
      }
    },

    # ---------------- שתן/גניטואורינרי ----------------
    "שתן/גניטואורינרי": {
      "דיזוריה/UTI": {
        "questions": ["תכיפות/צריבה/דם?", "חום/כאב מותני/בחילות?", "הריון/סוכרת/קטטר?"],
        "physical_exam": [{"label":"רגישות סופראפובית"},{"label":"CVA"}],
        "labs": [L("סטיק שתן + מיקרו","לויקוציטים/ניטריטים/דם"), L("תרבית שתן","אנטיביוגרמה"), L("CBC/CRP","חומרת זיהום")],
        "imaging": [IMG("US כליות/שלפוחית","Complicated/retention")],
        "scores": []
      },

      "כאב מותני - חשד לאבן": {
        "questions": ["כאב התקפי מקרין למפשעה", "בחילות/המטוריה", "אבנים בעבר"],
        "physical_exam": [{"label":"CVA"}],
        "labs": [L("שתן כללית","דם/זיהום"), L("BMP","כליה")],
        "imaging": [IMG("CT low-dose","רגישות גבוהה"), IMG("US","בהריון/להימנע מקרינה")],
        "scores": []
      },

      "שליפת קטטר שתן": {
        "questions": ["זמן החדרת הקטטר והסיבה", "קושי בהטלה/כאב/דם", "זיהומים קודמים"],
        "physical_exam": [{"label":"בדיקת אזור השופכה והפניס/פרינאום"}],
        "labs": [],
        "imaging": [],
        "scores": [],
        "notes": ["אספטיקה, תיאום אורולוגי אם קושי"]
      },

      "נפרוסטום": {
        "questions": ["סיבה/מועד החלפה אחרון/חום/כאב גב"],
        "physical_exam": [{"label":"בדיקת אתר הניקוז"}],
        "labs": [L("תרבית שתן/נוזל מנפרוסטום","אם הפרשה/חום")],
        "imaging": [],
        "scores": []
      },

      "ליין דיאליזה": {
        "questions": ["כאב/אודם/הפרשה/חום", "מועד דיאליזה אחרון"],
        "physical_exam": [{"label":"הערכת אתר הקטטר/פיסטולה"}],
        "labs": [L("תרביות דם","אם חום")],
        "imaging": [],
        "scores": [S("qSOFA","ספסיס")],
        "notes": []
      }
    },

    # ---------------- א.א.ג ----------------
    "א.א.ג": {
      "דימום אפי ספונטני": {
        "questions": ["חד/דו צדדי, טראומה/חיטוט/מדללים", "יתר ל\"ד?"],
        "physical_exam": [{"label":"בדיקה קדמית של חלל האף"},{"label":"טמפונדה קדמית אם צריך"}],
        "labs": [L("CBC","Hb"), L("קרישה","INR/aPTT","מדללים")],
        "imaging": [],
        "scores": []
      },
      "כאב גרון": {
        "questions": ["חום/דיספגיה/ריח רע/פריחה"],
        "physical_exam": [{"label":"בדיקת לוע ובלוטות"}],
        "labs": [L("Strep swab","אם חשד סטרפטוקוק")],
        "imaging": [],
        "scores": []
      },
      "כאב אוזן": {
        "questions": ["חום/הפרשה/ירידה בשמיעה"],
        "physical_exam": [{"label":"בדיקת טימפאנום"}],
        "labs": [],
        "imaging": [],
        "scores": []
      },
      "גוף זר באף/אוזן/לוע": {
        "questions": ["סוג וזמן, קוצר נשימה"],
        "physical_exam": [{"label":"הדמיה אם חשד לגוף זר שאינו נראה"}],
        "labs": [],
        "imaging": [IMG("צילום","לפי סוג")],
        "scores": []
      }
    },

    # ---------------- עיניים ----------------
    "עיניים": {
      "Red eye": {
        "questions": ["כאב/פוטופוביה/הפרשות/עדשות מגע", "טראומה/גוף זר"],
        "physical_exam": [{"label":"בדיקת חדות ראייה"},{"label":"פלואורסצאין/הפיכת עפעף"}],
        "labs": [],
        "imaging": [],
        "scores": [],
        "notes": ["עדשות מגע - כיסוי פסאודומונס"]
      },
      "ירידה חדה בראייה": {
        "questions": ["פתאומי/הדרגתי, חד/דו עיני", "וילון/פוטופסיות", "כאב עיני"],
        "physical_exam": [{"label":"חדות ראייה"},{"label":"שדות ותנועות עיניים"}],
        "labs": [],
        "imaging": [IMG("OCT/US עיני","לפי זמינות")],
        "scores": []
      },
      "גוף זר בעין": {
        "questions": ["מהירות/חומר, עדשות מגע"],
        "physical_exam": [{"label":"הפיכת עפעף ופלואורסצאין"}],
        "labs": [],
        "imaging": [IMG("צילום/CT מסלול","חשד מתכתי חדיר")],
        "scores": []
      }
    },

    # ---------------- אנדוקריני ----------------
    "אנדוקריני": {
      "היפרגליקמיה": {
        "questions": ["פוליאוריה/פולידיפסיה/ירידה במשקל", "בחילות/כאבי בטן/ישנוניות (DKA/HHS)", "זיהום? סטרואידים? החמצת אינסולין?"],
        "physical_exam": [{"label":"מדדים"},{"label":"התייבשות/טורגור"},{"label":"נשימות קוסמאל"},{"label":"בדיקת בטן"}],
        "labs": [L("גלוקוז מיידי","אישור","מידי"), L("BMP","אלקטרוליטים/כליה"), L("VBG/ABG + pH","חמצת","חשד ל-DKA/HHS"), L("קטונים בדם/שתן","DKA"), L("CBC/CRP","מוקד זיהומי"), L("אוסמולריות","HHS"), L("ECG","K⁺ חריג")],
        "imaging": [],
        "scores": [S("qSOFA","אם חשד לזיהום")],
        "notes": ["אם DKA/HHS - נוזלים, K⁺, אינסולין IV, טיפול במוקד"]
      },

      "תירוטוקסיקוזיס חשד": {
        "questions": ["ירידה במשקל/טכיקרדיה/אי שקט/זיעה", "תרופות: אמיאודרון/לבותירוקסין/יוד", "עין גרייבס, הריון/פוסט-פרטום"],
        "physical_exam": [{"label":"דופק/ל\"ד/טמפ'"},{"label":"רטיטת אצבעות דקה (fine tremor)"},{"label":"בלוטת התריס - הגדלה/רגישות/איוושה"},{"label":"עיניים - פרופטוזיס/לג אופתלמוס"}],
        "labs": [L("TSH","סקר","מידי"), L("FT4/FT3","אישור יתר","TSH נמוך"), L("אלקטרוליטים/גלוקוז","טריגרים"), L("טרופונין/BNP","מעורבות לבבית")],
        "imaging": [IMG("ECG","טכיקרדיה/פלפיטציות"), IMG("US תירואיד","קשריות/דלקת"), IMG("RAIU/סינטיגרפיה","אבחנת מקור")],
        "scores": [S("Burch–Wartofsky","סיכון למשבר תירוטוקסי","≥45 סביר מאוד","<25 לא סביר")],
        "notes": ["בלוקר בטא לפי התוויה; חשד למשבר - טיפול דחוף לפי פרוטוקול"]
      },

      "משבר אדרנלי": {
        "questions": ["סטרואידים כרוניים/הפסקה", "לחץ/זיהום/ניתוח לאחרונה"],
        "physical_exam": [{"label":"ל\"ד נמוך/שוק"},{"label":"התייבשות"}],
        "labs": [L("Na⁺/K⁺/גלוקוז","היפונתרמיה/היפרקלמיה/היפוגליקמיה"), L("קורטיזול","לפני סטרואידים אם אפשר")],
        "imaging": [],
        "scores": [],
        "notes": ["סטרס-דוז סטרואידים, נוזלים, תיקון גלוקוז/אלקטרוליטים"]
      }
    },

    # ---------------- המטולוגי ----------------
    "המטולוגי": {
      "דימום ספונטני": {
        "questions": ["מיקום/כמות/משך", "מדללים/מחלות כבד/כליה", "פציעות/טראומה"],
        "physical_exam": [{"label":"סימני דימום עוריים/ריריות"},{"label":"המופדת/המטומות"}],
        "labs": [L("CBC","טסיות/Hb"), L("PT/INR, aPTT","קרישה"), L("כימיה/כבד","סיבה משנית")],
        "imaging": [],
        "scores": []
      },

      "דימום מפצע": {
        "questions": ["מועד/נסיבות", "מדללים", "לחץ ישיר/תפרים קיימים"],
        "physical_exam": [{"label":"הערכת פצע ועומק"},{"label":"לחץ ישיר/חבישה לחץ"}],
        "labs": [L("CBC","Hb"), L("קרישה","INR/aPTT")],
        "imaging": [],
        "scores": []
      }
    },

    # ---------------- נשים ומיילדות ----------------
    "נשים ומיילדות": {
      "דימום בהריון מוקדם": {
        "questions": ["LMP, כאבי אגן, סינקופה/כאבים חד צדדיים", "הריונות קודמים/הפלות", "טיפולי פוריות"],
        "physical_exam": [{"label":"בדיקה דו ידנית עדינה"},{"label":"בדיקת צוואר"}],
        "labs": [L("β-hCG סדרתי","אבחנה","מידי"), L("Rh סוג","אימונופרופילקסיס")],
        "imaging": [IMG("US טרנסווגינלי","קביעת מיקום ההריון")],
        "scores": []
      },

      "כאבי אגן": {
        "questions": ["מחזור, הפרשות, חום", "היסטוריה של PID/ציסטות", "יחסי מין לא מוגנים"],
        "physical_exam": [{"label":"רגישות אגן/צוואר"},{"label":"בדיקת בטן תחתונה"}],
        "labs": [L("STD swabs","אם חשד"), L("β-hCG","שלילת הריון")],
        "imaging": [IMG("US אגן","ציסטה/תסביב")],
        "scores": []
      }
    },

    # ---------------- פסיכיאטריה ----------------
    "פסיכיאטריה": {
      "אובדנות": {
        "questions": ["מחשבות/תוכנית/אמצעים/ניסיונות קודמים", "שימוש בחומרים/פסיכוזה/דכאון"],
        "physical_exam": [{"label":"הערכה מנטלית כללית"}],
        "labs": [L("גלוקוז/אלקטרוליטים/טוקסיקולוגיה","לפי מצב")],
        "imaging": [],
        "scores": [S("C-SSRS","הערכת סיכון אובדני")],
        "notes": ["לפי נהלי ביטחון, ליווי והשגחה"]
      },

      "חרדה חריפה": {
        "questions": ["טריגר/פאניקה/תסמיני גוף", "היסטוריה פסיכיאטרית"],
        "physical_exam": [{"label":"הערכה כללית/שלילת מסכנות חיים"}],
        "labs": [],
        "imaging": [],
        "scores": []
      }
    },

    # ---------------- זיהומיות/כללי ----------------
    "זיהומיות/כללי": {
      "חום לא ברור": {
        "questions": ["משך/שעות/רעד/מסעות/חשיפות/חיות/אנטיביוטיקה", "מחלות רקע וחיסונים"],
        "physical_exam": [{"label":"בדיקה שיטתית מלאה"}],
        "labs": [L("CBC, CRP","דלקת/זיהום"), L("תרביות דם x2","אם חום גבוה/ספסיס"), L("שתן כללית ותרבית","מוקד"), L("כימיה/תפקודי כבד","מוקד")],
        "imaging": [IMG("צילום חזה","מוקד נשימתי")],
        "scores": [S("qSOFA","ספסיס")],
        "notes": []
      },

      "נשיכת כלב": {
        "questions": ["מתי ננשך? בעל חיים מוכר? חיסון כלבת? מיקום הפצע ועומקו? תרופות/דיכוי חיסון?"],
        "physical_exam": [{"label":"הערכת פצע, גידים/עצבים/כלי דם ודפקים דיסטליים"}],
        "labs": [L("CBC","לויקוציטוזיס","אם חום/אודם/נפיחות"), L("CRP","דלקת","חשד לצלוליטיס")],
        "imaging": [IMG("צילום","חשד לשן/גוף זר/חדירה עמוקה")],
        "scores": [S("qSOFA","ספסיס","≥2 סיכון מוגבר","0-1 לא שולל")],
        "notes": ["ניקוי 10-15 דק', הטריה עדינה, אנטיביוטיקה מתאימה", "דיווח והתייעצות עם לשכת הבריאות המחוזית לגבי PEP לכלבת", "טטנוס לפי סטטוס, שקילת TIG"]
      }
    }
  }
}

# ----------------------------------------------------------------
# VIDEO LINKS - קישורי וידאו לפי label
# חשוב: ה-label חייב להיות זהה לטקסט שב-physical_exam כדי שהקישור ישודך אוטומטית
# ----------------------------------------------------------------
VIDEO_LINKS = {
  "metadata": {"version": "1.0.0", "notes": "ניתן להחליף לסרטונים שלך. התאמת label 1:1."},

  "לב וכלי דם": [
    {"label": "האזנה ללב (קצב/אוושות)", "urls": ["https://www.youtube.com/results?search_query=cardiac+auscultation+osce"]},
    {"label": "JVP ובצקות היקפיות", "urls": ["https://www.youtube.com/watch?v=Ez7KsKRi8e8"]},
    {"label": "האזנה לריאות (קראקלס)", "urls": ["https://www.youtube.com/results?search_query=lung+auscultation+crackles"]},
    {"label": "מישוש דופן חזה", "urls": ["https://www.youtube.com/results?search_query=chest+wall+palpation+examination"]}
  ],

  "נשימה": [
    {"label": "סטורציה ו-RR", "urls": ["https://www.youtube.com/results?search_query=pulse+oximetry+respiratory+rate"]},
    {"label": "האזנה - צפצופים/קראקלס", "urls": ["https://www.youtube.com/results?search_query=lung+auscultation+osce"]},
    {"label": "POCUS לב/ריאות", "urls": ["https://www.youtube.com/results?search_query=lung+ultrasound+B+lines+pleural+effusion"]}
  ],

  "מערכת עצבים": [
    {"label": "Dix-Hallpike", "urls": ["https://www.youtube.com/watch?v=D6qEdlFVxig", "https://www.youtube.com/watch?v=Ey7TlLJUErY"]},
    {"label": "בדיקת ניסטגמוס", "urls": ["https://www.youtube.com/results?search_query=nystagmus+examination+osce"]},
    {"label": "בדיקה נוירולוגית ממוקדת/עצבי גולגולת", "urls": ["https://www.youtube.com/results?search_query=cranial+nerve+examination+osce"]}
  ],

  "עיכול": [
    {"label": "מישוש בטן והערכת רגישות", "urls": ["https://www.youtube.com/results?search_query=abdominal+examination+palpation+osce"]},
    {"label": "סימני גירוי צפקי וריבאונד", "urls": ["https://www.youtube.com/results?search_query=peritoneal+signs+rebound+guarding+exam"]},
    {"label": "סימן מרפי", "urls": ["https://www.youtube.com/results?search_query=Murphy+sign+examination"]}
  ],

  "שתן/גניטואורינרי": [
    {"label": "רגישות CVA", "urls": ["https://www.youtube.com/results?search_query=CVA+tenderness+exam"]},
    {"label": "בדיקת אזור השופכה והפניס/פרינאום", "urls": ["https://www.youtube.com/results?search_query=male+genitourinary+exam+osce"]}
  ],

  "א.א.ג": [
    {"label": "טמפונדה קדמית אם צריך", "urls": ["https://www.youtube.com/results?search_query=anterior+nasal+packing+epistaxis"]},
    {"label": "בדיקה קדמית של אף/אוזן/לוע", "urls": ["https://www.youtube.com/results?search_query=ENT+anterior+rhinoscopy+otoscopy+oropharynx+exam"]}
  ],

  "עור / טראומה": [
    {"label": "הערכת עור - מורפולוגיה והתפשטות", "urls": ["https://www.youtube.com/results?search_query=skin+examination+osce"]},
    {"label": "בדיקת זיהום רקמות רכות (צלוליטיס/אבצס)", "urls": ["https://www.youtube.com/results?search_query=soft+tissue+infection+abscess+exam"]},
    {"label": "הערכת פצע, גידים/עצבים/כלי דם ודפקים דיסטליים", "urls": ["https://www.youtube.com/results?search_query=dog+bite+wound+examination"]}
  ],

  "עיניים": [
    {"label": "בדיקת חדות ראייה", "urls": ["https://www.youtube.com/results?search_query=visual+acuity+snellen+osce"]},
    {"label": "שדות ראייה ותנועות עיניים", "urls": ["https://www.youtube.com/results?search_query=eye+movements+visual+fields+examination"]},
    {"label": "הפיכת עפעף ופלואורסצאין", "urls": ["https://www.youtube.com/results?search_query=eyelid+eversion+fluorescein"]}
  ]
}

# כתיבה לקבצים
KNOW_PATH.write_text(json.dumps(KNOWLEDGE, ensure_ascii=False, indent=2), encoding="utf-8")
VID_PATH.write_text(json.dumps(VIDEO_LINKS, ensure_ascii=False, indent=2), encoding="utf-8")

print("✅ knowledge.json ו-video_links.json עודכנו בהצלחה.")
print(f"📄 {KNOW_PATH}")
print(f"📄 {VID_PATH}")